// everyone should be very afrad of mr hacker gotbannedforthe3rdtime !!!! he is a REAL hacker guys trust me

(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();const rt={apiKey:"AIzaSyC9gTHFZMUaHiPQYg8oDCaGHafkOQrdTv0",authDomain:"zilo-ac050.firebaseapp.com",projectId:"zilo-ac050",storageBucket:"zilo-ac050.firebasestorage.app",messagingSenderId:"874684039190",appId:"1:874684039190:web:0b8dba6cb8321cb6997537",measurementId:"G-ZN7BF0L7HJ"},He=document.getElementById("loading-screen");function ct(){He.style.display="flex"}function ee(){He.style.display="none"}firebase.initializeApp(rt);const G=firebase.auth(),r=firebase.database(),J={home:{currentPage:1,totalPages:1,postsPerPage:10}};let d=null,g=null,$=null;const ve=document.getElementById("auth-container"),B=document.getElementById("login-form"),k=document.getElementById("register-form"),lt=document.getElementById("show-register"),dt=document.getElementById("show-login"),Z=document.getElementById("auth-error"),K=document.getElementById("auth-success"),ye=document.getElementById("app"),we=document.getElementById("post-input"),ut=document.getElementById("post-button"),P=document.getElementById("feed-posts"),mt=document.getElementById("profile-posts"),v=document.getElementById("users-list"),se=document.getElementById("search-input"),A=document.getElementById("tagged-posts"),Se=document.getElementById("edit-bio"),ft=document.getElementById("profile-display-name"),pt=document.getElementById("profile-username"),gt=document.getElementById("profile-bio"),ht=document.getElementById("user-profile-bio"),Ee=document.getElementById("profile-pic-placeholder"),U=document.getElementById("profile-pic-img"),vt=document.getElementById("profile-posts-count"),oe=document.getElementById("profile-followers-count"),ie=document.getElementById("profile-following-count"),yt=document.getElementById("change-profile-pic"),wt=document.getElementById("edit-profile-form"),Ae=document.getElementById("edit-display-name"),De=document.getElementById("edit-profile-pic"),R={home:document.getElementById("nav-home"),explore:document.getElementById("nav-explore"),profile:document.getElementById("nav-profile"),tagged:document.getElementById("nav-tagged"),settings:document.getElementById("nav-settings"),logout:document.getElementById("nav-logout")},Oe={":sob:":"ðŸ˜­",":smile:":"ðŸ˜ƒ",":heart:":"â¤ï¸",":broken_heart:":"ðŸ’”",":thumbsup:":"ðŸ‘",":thumbsdown:":"ðŸ‘Ž",":fire:":"ðŸ”¥",":laughing:":"ðŸ˜†",":confused:":"ðŸ˜•",":cry:":"ðŸ˜¢",":sweat:":"ðŸ˜…",":sweat_smile:":"ðŸ˜…",":joy:":"ðŸ˜‚",":sunglasses:":"ðŸ˜Ž",":star_struck:":"ðŸ¤©",":thinking:":"ðŸ¤”",":sleeping:":"ðŸ˜´",":pensive:":"ðŸ˜”",":grin:":"ðŸ˜",":wink:":"ðŸ˜‰",":kiss:":"ðŸ˜˜",":yum:":"ðŸ˜‹",":clap:":"ðŸ‘",":wave:":"ðŸ‘‹",":muscle:":"ðŸ’ª",":raised_hands:":"ðŸ™Œ",":pray:":"ðŸ™",":sparkles:":"âœ¨",":biceps:":"ðŸ’ª",":robot:":"ðŸ¤–",":alien:":"ðŸ‘½",":unicorn:":"ðŸ¦„",":santa:":"ðŸŽ…",":party:":"ðŸ¥³",":exploding_head:":"ðŸ¤¯",":shushing:":"ðŸ¤«",":nerd:":"ðŸ¤“",":woozy:":"ðŸ¥´",":facepalm:":"ðŸ¤¦",":mind_blown:":"ðŸ¤¯",":innocent:":"ðŸ˜‡",":speaking_head:":"ðŸ—£ï¸",":fearful:":"ðŸ˜¨",":face_with_thermometer:":"ðŸ¤’",":face_with_head_bandage:":"ðŸ¤•",":vomiting_face:":"ðŸ¤®",":nauseated_face:":"ðŸ¤¢",":cold_face:":"ðŸ¥¶",":hot_face:":"ðŸ¥µ",":zany:":"ðŸ¤ª",":relieved:":"ðŸ˜Œ",":hugging:":"ðŸ¤—",":rolling_eyes:":"ðŸ™„",":expressionless:":"ðŸ˜‘",":ok_hand:":"ðŸ‘Œ",":crossed_fingers:":"ðŸ¤ž",":v:":"âœŒï¸",":fist:":"âœŠ",":call_me:":"ðŸ¤™",":pinching_hand:":"ðŸ¤",":raised_back_of_hand:":"ðŸ¤š",":handshake:":"ðŸ¤",":birthday:":"ðŸŽ‚",":champagne:":"ðŸ¾",":pizza:":"ðŸ•",":hamburger:":"ðŸ”",":popcorn:":"ðŸ¿",":taco:":"ðŸŒ®",":coffee:":"â˜•",":beer:":"ðŸº",":wine_glass:":"ðŸ·",":cake:":"ðŸ°",":cocktail:":"ðŸ¸",":donut:":"ðŸ©",":cookie:":"ðŸª",":chocolate:":"ðŸ«",":fries:":"ðŸŸ",":icecream:":"ðŸ¦",":sushi:":"ðŸ£",":hotdog:":"ðŸŒ­",":avocado:":"ðŸ¥‘",":banana:":"ðŸŒ",":apple:":"ðŸŽ",":grapes:":"ðŸ‡",":carrot:":"ðŸ¥•",":bread:":"ðŸž",":bento:":"ðŸ±",":rose:":"ðŸŒ¹",":sunflower:":"ðŸŒ»",":bouquet:":"ðŸ’",":leaf:":"ðŸƒ",":dog:":"ðŸ¶",":cat:":"ðŸ±",":panda:":"ðŸ¼",":monkey:":"ðŸµ",":turtle:":"ðŸ¢",":whale:":"ðŸ³",":shark:":"ðŸ¦ˆ",":rabbit:":"ðŸ°",":fox:":"ðŸ¦Š",":bear:":"ðŸ»",":elephant:":"ðŸ˜",":dragon:":"ðŸ‰",":owl:":"ðŸ¦‰",":bee:":"ðŸ",":ladybug:":"ðŸž",":snake:":"ðŸ",":cactus:":"ðŸŒµ",":volcano:":"ðŸŒ‹",":soccer:":"âš½",":basketball:":"ðŸ€",":football:":"ðŸˆ",":tennis:":"ðŸŽ¾",":guitar:":"ðŸŽ¸",":microphone:":"ðŸŽ¤",":video_game:":"ðŸŽ®",":headphones:":"ðŸŽ§",":camera:":"ðŸ“·",":computer:":"ðŸ’»",":phone:":"ðŸ“±",":lightbulb:":"ðŸ’¡",":books:":"ðŸ“š",":notebook:":"ðŸ““",":calendar:":"ðŸ“…",":toolbox:":"ðŸ§°",":hammer:":"ðŸ”¨",":paintbrush:":"ðŸ–Œï¸",":wrench:":"ðŸ”§",":flashlight:":"ðŸ”¦",":sun:":"â˜€ï¸",":cloud:":"â˜ï¸",":rain:":"ðŸŒ§ï¸",":snow:":"â„ï¸",":thunder:":"ðŸŒ©ï¸",":umbrella:":"â˜”",":airplane:":"âœˆï¸",":car:":"ðŸš—",":rocket:":"ðŸš€",":train:":"ðŸš†",":globe:":"ðŸŒ",":mountain:":"â›°ï¸",":beach:":"ðŸ–ï¸",":tent:":"â›º",":check:":"âœ”ï¸",":x:":"âŒ",":warning:":"âš ï¸",":question:":"â“",":exclamation:":"â—",":100:":"ðŸ’¯",":money:":"ðŸ’°",":crown:":"ðŸ‘‘",":lock:":"ðŸ”’",":unlock:":"ðŸ”“",":key:":"ðŸ”‘",":rainbow:":"ðŸŒˆ",":star:":"â­",":boom:":"ðŸ’¥",":hourglass:":"â³",":gem:":"ðŸ’Ž",":balloon:":"ðŸŽˆ",":gift:":"ðŸŽ",":label:":"ðŸ·ï¸",":trophy:":"ðŸ†",":medal:":"ðŸ…",":dice:":"ðŸŽ²",":clover:":"ðŸ€",":peace:":"â˜®ï¸",":wilted-rose:":"ðŸ¥€"},D={home:document.getElementById("home-page"),explore:document.getElementById("explore-page"),profile:document.getElementById("profile-page"),tagged:document.getElementById("tagged-page"),settings:document.getElementById("settings-page"),userProfile:document.getElementById("user-profile-page"),postDetail:document.getElementById("post-detail-page")},Et=document.getElementById("user-profile-display-name"),Lt=document.getElementById("user-profile-username"),Le=document.getElementById("user-profile-pic-placeholder"),z=document.getElementById("user-profile-pic-img"),bt=document.getElementById("user-profile-posts-count"),ae=document.getElementById("user-profile-followers-count"),re=document.getElementById("user-profile-following-count"),T=document.getElementById("follow-user-btn"),je=document.getElementById("prev-page"),qe=document.getElementById("next-page"),Pt=document.getElementById("current-page"),$t=document.getElementById("total-pages"),I=document.getElementById("page-numbers"),O=document.getElementById("home-pagination");je.addEventListener("click",()=>_e("prev"));qe.addEventListener("click",()=>_e("next"));function _e(e){const t=J.home;let n=t.currentPage;if(e==="prev"&&t.currentPage>1)n=t.currentPage-1;else if(e==="next"&&t.currentPage<t.totalPages)n=t.currentPage+1;else return;O.classList.add("hidden"),P.innerHTML='<div class="pagination-loading"><div class="loading-spinner"></div></div>',me(n)}function te(e){e<1||e>J.home.totalPages||(O.classList.add("hidden"),P.innerHTML='<div class="pagination-loading"><div class="loading-spinner"></div></div>',me(e))}function Ct(){const e=J.home;Pt.textContent=e.currentPage,$t.textContent=e.totalPages,je.disabled=e.currentPage===1,qe.disabled=e.currentPage===e.totalPages,I.innerHTML="";const t=document.createElement("div");if(t.className=`page-number ${e.currentPage===1?"active":""}`,t.textContent="1",t.addEventListener("click",()=>te(1)),I.appendChild(t),e.currentPage>3){const o=document.createElement("div");o.className="page-number",o.textContent="...",o.style.cursor="default",I.appendChild(o)}let n=Math.max(2,e.currentPage-1),s=Math.min(e.totalPages-1,e.currentPage+1);e.currentPage===2?s=Math.min(4,e.totalPages-1):e.currentPage===e.totalPages-1&&(n=Math.max(e.totalPages-2,2));for(let o=n;o<=s;o++){const i=document.createElement("div");i.className=`page-number ${e.currentPage===o?"active":""}`,i.textContent=o,i.addEventListener("click",()=>te(o)),I.appendChild(i)}if(s<e.totalPages-1){const o=document.createElement("div");o.className="page-number",o.textContent="...",o.style.cursor="default",I.appendChild(o)}if(e.totalPages>1){const o=document.createElement("div");o.className=`page-number ${e.currentPage===e.totalPages?"active":""}`,o.textContent=e.totalPages,o.addEventListener("click",()=>te(e.totalPages)),I.appendChild(o)}O.classList.remove("hidden")}lt.addEventListener("click",function(e){e.preventDefault(),B.classList.add("hidden"),k.classList.remove("hidden"),_()});dt.addEventListener("click",function(e){e.preventDefault(),B.classList.remove("hidden"),k.classList.add("hidden"),_()});B.addEventListener("submit",function(e){e.preventDefault();const t=document.getElementById("login-email").value,n=document.getElementById("login-password").value;_(),G.signInWithEmailAndPassword(t,n).then(()=>{m("Welcome back!!","success"),B.reset(),window.location.reload()}).catch(s=>{le(s.message)})});function E(e){return e.replace(/[^a-zA-Z0-9_.-]/g,"")}k.addEventListener("submit",function(e){e.preventDefault();const t=document.getElementById("register-username").value,n=E(t),s=document.getElementById("register-displayname").value,o=E(s),i=document.getElementById("register-email").value,a=document.getElementById("register-password").value;_(),r.ref("usernames/"+n).once("value").then(c=>{if(c.exists()){le(`${n} is already taken.. try another..`);return}return G.createUserWithEmailAndPassword(i,a).then(l=>{const u=l.user,p={uid:u.uid,username:n,displayName:o,email:i,profilePicture:"",createdAt:Date.now()},h={};return h[`users/${u.uid}`]=p,h[`usernames/${n}`]=u.uid,r.ref().update(h)}).then(()=>{k.reset(),At("account made"),m("Welcome to ZILO!!","success"),window.location.reload(),B.classList.remove("hidden"),k.classList.add("hidden")})}).catch(c=>{le(c.message)})});G.onAuthStateChanged(e=>{ct(),e?(d=e,r.ref(`users/${e.uid}`).once("value").then(t=>{g=t.val(),pe(g),ve.classList.add("hidden"),ye.classList.remove("hidden"),Y(),Zt(),ee()}).catch(t=>{m(`error getting user data ${t}`,"error"),ee()})):(d=null,g=null,ve.classList.remove("hidden"),ye.classList.add("hidden"),B.reset(),k.reset(),B.classList.remove("hidden"),k.classList.add("hidden"),_(),ee())});for(const[e,t]of Object.entries(R))t.addEventListener("click",function(n){if(n.preventDefault(),e==="logout"){G.signOut();return}x(e)});ut.addEventListener("click",kt);wt.addEventListener("submit",function(e){e.preventDefault(),Ht()});se.addEventListener("input",Dt(function(){fe(se.value)},300));yt.addEventListener("click",()=>{const e=prompt("enter the URL of your new profile picture:");e&&St(e)});T&&T.addEventListener("click",()=>{d&&$&&zt($)});function x(e){for(const t of Object.values(D))t.classList.add("hidden");for(const t of Object.values(R))t.classList.remove("active");D[e]&&D[e].classList.remove("hidden"),R[e]&&R[e].classList.add("active"),Fe(e)}function Y(){for(const[e,t]of Object.entries(D))if(!t.classList.contains("hidden")){Fe(e);return}x("home")}function Fe(e){switch(e){case"home":me();break;case"explore":fe("");break;case"profile":j(d.uid),Q();break;case"tagged":Nt();break;case"settings":Ae.value=g.displayName||"",De.value=g.profilePicture||"",Se.value=g.bio||"";break;case"userProfile":$&&(j($),ge($));break}}function be(e){let t=0;for(let n=0;n<e.length;n++){const s=e.charCodeAt(n);t=(t<<5)-t+s,t|=0}return t}function kt(){const e=we.value.trim();e&&r.ref(`users/${d.uid}/recentPosts`).once("value").then(t=>{const n=t.val()||[],s=Date.now(),o=be(e),i=s-6e4;if(n.filter(u=>u.timestamp>i).length>=5)return m("you can only post 5 times per minute.. please wait.","error"),Promise.reject("Rate limit exceeded");const c=s-6e5,l=n.filter(u=>u.timestamp>c&&u.contentHash===o);if(l.length>=2){const u=l[0].timestamp,p=s-u,h=Math.min(3e5,6e4*Math.pow(2,l.length));if(p<h){const f=Math.ceil((h-p)/6e4);return m(`please wait ${f} minute(s) before posting similar content again`,"error"),Promise.reject("Duplicate content cooldown")}}return tt()}).then(t=>{if(nt(e,t)){m("your message contains a blocked word, please revise and try again","error");return}d.uid,g.username,g.displayName,g.profilePicture;const n=Bt(e);n.length>0;const s=r.ref("posts").push();return r.ref(`users/${d.uid}/recentPosts`).once("value").then(o=>{let i=o.val()||[];return i.push({timestamp:Date.now(),contentHash:be(e)}),i=i.slice(-15),r.ref(`users/${d.uid}/recentPosts`).set(i)}).then(()=>{we.value="",n.length>0&&xt(n,s.key),m("post created successfully!!","success"),setTimeout(()=>{x("profile"),j(d.uid)},1e3)})}).catch(t=>{t!=="Rate limit exceeded"&&t!=="Duplicate content cooldown"&&m(`error creating post: ${t}`,"error")})}function Bt(e){const t=/@([a-zA-Z0-9_.-]+)/g,n=e.match(t);return n?n.map(s=>s.substring(1)):[]}function xt(e,t,n){[...new Set(e)].forEach(o=>{r.ref(`usernames/${o}`).once("value").then(i=>{i.exists()&&(i.val(),d.uid)})})}function w(e){return typeof e!="string"?"":e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/\n/g,"<br>")}function ce(e,t){r.ref(`posts/${e}`).once("value").then(n=>{if(n.exists()){const s={id:e,...n.val()},o=document.querySelector("#post-detail-page .post-container");o.innerHTML="",o.appendChild(M(s)),ue(e),x("postDetail"),t?(document.getElementById("comment-input").value=t+" ",document.getElementById("comment-input").focus()):document.getElementById("comment-input").value=""}})}function ue(e){const t=document.getElementById("comments-container");t.innerHTML='<div class="loading"><div class="loading-spinner"></div></div>',r.ref(`posts/${e}/comments`).orderByChild("timestamp").once("value").then(n=>{t.innerHTML="",n.exists()?n.forEach(s=>{const o=s.val(),i=s.key,a=It(o,i,e);t.appendChild(a)}):t.innerHTML=`<div class="no-comments">chirp chirp.. there's nothing here..</div>`})}function It(e,t,n){const s=document.createElement("div");s.className="comment",s.setAttribute("data-comment-id",t),s.setAttribute("data-post-id",n);const o=e.likes?Object.keys(e.likes).length:0,i=e.likes&&d&&e.likes[d.uid],a=d&&e.uid===d.uid,c=a?'<button class="comment-delete-btn" title="delete comment"><i class="fas fa-trash"></i></button>':"",l=`<button class="comment-like-btn${i?" liked":""}" title="like comment">
        <i class="fa${i?"s":"r"} fa-heart"></i> <span>${o}</span>
    </button>`,u='<button class="comment-mention-btn" title="mention user"><i class="fas fa-at"></i></button>',p=We(e.text);s.innerHTML=`
        <div class="comment-avatar">
            ${e.profilePicture?`<img src="${e.profilePicture}" alt="${e.username}">`:'<i class="fas fa-user"></i>'}
        </div>
        <div class="comment-main">
            <div class="comment-header">
                <div class="comment-info">
                    <span class="comment-username">${e.username}</span>
                    <span class="comment-time">${Ye(e.timestamp)}</span>
                </div>
                <div class="comment-actions">
                    ${l}
                    ${u}
                    ${c}
                </div>
            </div>
            <div class="comment-content">${p}</div>
        </div>
    `,Re(s,Ke),s.querySelector(".comment-like-btn").addEventListener("click",function(y){y.stopPropagation(),Ue(n,t)}),a&&s.querySelector(".comment-delete-btn").addEventListener("click",function(y){y.stopPropagation(),Tt(n,t)}),s.querySelector(".comment-mention-btn").addEventListener("click",function(y){y.stopPropagation(),document.getElementById("comment-input").value=`@${e.username} `,document.getElementById("comment-input").focus()});const h=s.querySelector(".comment-avatar"),f=s.querySelector(".comment-username");return h&&h.addEventListener("click",y=>{y.stopPropagation(),N(e.uid)}),f&&f.addEventListener("click",y=>{y.stopPropagation(),N(e.uid)}),s}function Tt(e,t){confirm("are ya sure u want to delete this comment?")&&r.ref(`posts/${e}/comments/${t}`).remove().then(()=>r.ref(`posts/${e}/commentCount`).once("value")).then(n=>{const s=n.val()||0;return r.ref(`posts/${e}/commentCount`).set(Math.max(s-1,0))}).then(()=>{m("comment deleted successfully","success"),ue(e)}).catch(n=>{m(`error deleting comment, try again: ${n}`,"error")})}function Ue(e,t){if(!d)return;const n=r.ref(`posts/${e}/comments/${t}/likes/${d.uid}`);n.once("value").then(s=>{const o=s.exists();o?n.remove():n.set(!0);const i=!o;document.querySelectorAll(`
                .comment[data-comment-id="${t}"],
                .post.comment-post[data-comment-id="${t}"]
            `).forEach(c=>{c.classList.contains("comment")?Mt(c,i):Xe(c,i)})})}function Mt(e,t){const n=e.querySelector(".comment-like-btn");if(n){const s=n.querySelector("i"),o=n.querySelector("span"),i=parseInt(o.textContent||"0");t?(n.classList.add("liked"),s.classList.remove("far"),s.classList.add("fas"),o.textContent=i+1):(n.classList.remove("liked"),s.classList.remove("fas"),s.classList.add("far"),o.textContent=Math.max(i-1,0))}}function me(e=1){P.innerHTML='<div class="loading"><div class="loading-spinner"></div></div>';let t=[];r.ref(`users/${d.uid}/following`).once("value").then(n=>{if(n.val()&&(t=Object.keys(n.val())),t.length===0){P.innerHTML='<div class="text-center text-muted py-5">follow some users to see posts!</div>',O.classList.add("hidden");return}const s=[],o=J.home,i=o.postsPerPage,a=t.map(c=>r.ref("posts").orderByChild("uid").equalTo(c).once("value").then(l=>{const u=l.val();u&&Object.entries(u).forEach(([p,h])=>{s.push({id:p,...h,likes:h.likes||{},displayName:w(h.displayName),username:E(h.username)})})}));return Promise.all(a).then(()=>{if(s.length===0){P.innerHTML='<div class="text-center text-muted py-5">follow some users to see posts!</div>',O.classList.add("hidden");return}s.sort((h,f)=>f.timestamp-h.timestamp);const c=s.length;o.totalPages=Math.ceil(c/i),o.currentPage=Math.min(e,o.totalPages);const l=(o.currentPage-1)*i,u=Math.min(l+i,c),p=s.slice(l,u);P.innerHTML="",p.forEach(h=>{const f=M(h);P.appendChild(f)}),Ct()})}).catch(n=>{m(`failed to load posts: ${n}`,"error"),P.innerHTML='<div class="alert alert-danger">failed to load posts, try again later..</div>'})}function j(e){const t=e===d.uid?mt:document.getElementById("user-profile-posts");t.innerHTML='<div class="loading"><div class="loading-spinner"></div></div>',r.ref("posts").orderByChild("uid").equalTo(e).once("value").then(n=>{const s=n.val()||{},o=Object.entries(s).map(([i,a])=>({id:i,...a,likes:a.likes||{},displayName:w(a.displayName),username:E(a.username)}));return r.ref("posts").once("value").then(i=>{const a=i.val()||{},c=[];Object.entries(a).forEach(([u,p])=>{p.comments&&Object.entries(p.comments).forEach(([h,f])=>{f.uid===e&&c.push({id:h,...f,parentPostId:u,isComment:!0,likes:f.likes||{},displayName:w(f.displayName||f.username),username:E(f.username),timestamp:f.timestamp,content:f.text})})});const l=[...o,...c];l.sort((u,p)=>p.timestamp-u.timestamp),t.innerHTML="",l.length>0?l.forEach(u=>{const p=M(u);u.isComment&&(p.classList.add("comment-post"),p.setAttribute("data-parent-post-id",u.parentPostId)),t.appendChild(p)}):t.innerHTML='<div class="text-center text-muted py-5">chrip chirp.. nothing here..</div>'})}).catch(n=>{m(`error loading user's posts: ${n}`,"error"),t.innerHTML='<div class="alert alert-danger">failed to load posts, try again later..</div>'})}function Nt(){A.innerHTML='<div class="loading"><div class="loading-spinner"></div></div>',r.ref("posts").orderByChild("timestamp").once("value").then(e=>{const t=[];e.val()&&Object.entries(e.val()).map(([s,o])=>({id:s,...o})).forEach(s=>{s.mentions&&s.mentions.includes(g.username)&&t.push(s)}),t.sort((n,s)=>s.timestamp-n.timestamp),A.innerHTML="",t.length>0?t.forEach(n=>{const s=M(n);A.appendChild(s)}):A.innerHTML='<div class="text-center text-muted py-5">no one has tagged you in a post yet..</div>'}).catch(e=>{m(`error fetching tagged posts: ${e}`,"error"),A.innerHTML='<div class="alert alert-danger">error fetching tagged posts, try again later</div>'})}function fe(e){if(e=e.trim(),e===""){r.ref("users").orderByChild("username").once("value").then(t=>{v.innerHTML="",t.val()?Object.values(t.val()).forEach(s=>{const o={...s,displayName:w(s.displayName),username:E(s.username)},i=ne(o);v.appendChild(i)}):v.innerHTML='<div class="text-center text-muted py-3">No users found</div>'}).catch(t=>{m(`Error searching users: ${t}`,"error"),v.innerHTML='<div class="alert alert-danger">Failed to search for users, try again later</div>'});return}if(e.startsWith("@")){const t=e.substring(1).toLowerCase();r.ref("users").orderByChild("username").limitToFirst(50).once("value").then(n=>{if(v.innerHTML="",n.val()){const s=Object.values(n.val()).filter(o=>o.username.toLowerCase().includes(t));if(s.length===0){v.innerHTML='<div class="text-center text-muted py-3">No users found with this username</div>';return}s.forEach(o=>{const i={...o,displayName:w(o.displayName),username:E(o.username)},a=ne(i);v.appendChild(a)})}else v.innerHTML='<div class="text-center text-muted py-3">No users found</div>'}).catch(n=>{m(`Error searching users: ${n}`,"error"),v.innerHTML='<div class="alert alert-danger">Failed to search for users, try again later</div>'})}else if(e.startsWith("#")){const t=e.toLowerCase();r.ref("posts").orderByChild("timestamp").once("value").then(n=>{v.innerHTML="";const s=n.val()||{},o=[];Object.entries(s).forEach(([i,a])=>{a.content&&a.content.toLowerCase().includes(t)&&o.push({id:i,...a,likes:a.likes||{},displayName:w(a.displayName),username:E(a.username)})}),o.length>0?(o.sort((i,a)=>a.timestamp-i.timestamp),v.innerHTML="",o.forEach(i=>{const a=M(i);v.appendChild(a)})):v.innerHTML='<div class="text-center text-muted py-3">No posts found with this tag</div>'})}else{const t=e.toLowerCase().split(" ");r.ref("posts").orderByChild("timestamp").once("value").then(n=>{v.innerHTML="";const s=n.val()||{},o=[];Object.entries(s).forEach(([i,a])=>{if(a.content){const c=a.content.toLowerCase();t.every(u=>c.includes(u))&&o.push({id:i,...a,likes:a.likes||{},displayName:w(a.displayName),username:E(a.username)})}}),o.length===0&&t.length>1&&Object.entries(s).forEach(([i,a])=>{if(a.content){const c=a.content.toLowerCase();t.some(u=>c.includes(u))&&o.push({id:i,...a,likes:a.likes||{},displayName:w(a.displayName),username:E(a.username)})}}),o.length>0?(o.sort((i,a)=>a.timestamp-i.timestamp),v.innerHTML="",o.forEach(i=>{const a=M(i);v.appendChild(a)})):r.ref("users").orderByChild("displayName").limitToFirst(50).once("value").then(i=>{if(i.val()){const a=Object.values(i.val()).filter(c=>c.displayName.toLowerCase().includes(e.toLowerCase())||c.username.toLowerCase().includes(e.toLowerCase()));a.length>0?(v.innerHTML="",a.forEach(c=>{const l={...c,displayName:w(c.displayName),username:E(c.username)},u=ne(l);v.appendChild(u)})):v.innerHTML='<div class="text-center text-muted py-3">No posts or users found</div>'}else v.innerHTML='<div class="text-center text-muted py-3">No posts or users found</div>'})})}}function Ht(){const e=Ae.value.trim(),t=De.value.trim(),n=Se.value.trim();if(!e){m("please put a display name","warning");return}const s={};s[`users/${d.uid}/displayName`]=e,t&&(s[`users/${d.uid}/profilePicture`]=t),s[`users/${d.uid}/bio`]=n,r.ref().update(s).then(()=>{m("profile updated successfully!","success"),g.displayName=e,t&&(g.profilePicture=t),g.bio=n,pe(g),D.profile.classList.contains("hidden")||Q(),ze()}).catch(o=>{m(`error updating profile: ${o}`,"error")})}function St(e){r.ref(`users/${d.uid}/profilePicture`).set(e).then(()=>{g.profilePicture=e,pe(g),ze(),m("profile picture updated successfully!!","success")}).catch(t=>{m(`error updating profile picture: ${t}`,"error")})}function ze(){r.ref("posts").orderByChild("uid").equalTo(d.uid).once("value").then(e=>{if(e.val){const t={};Object.entries(e.val()).forEach(([n,s])=>{t[`posts/${n}/displayName`]=g.displayName,t[`posts/${n}/profilePicture`]=g.profilePicture||""}),r.ref().update(t)}}).catch(e=>m(`Error updating posts with new profile data: ${e}`,"error"))}function pe(e){ft.textContent=e.displayName,pt.textContent=`@${e.username}`,gt.textContent=e.bio||"add a bio in settings!!",e.profilePicture?(Ee.classList.add("hidden"),U.classList.remove("hidden"),U.src=e.profilePicture):(Ee.classList.remove("hidden"),U.classList.add("hidden"),U.src=""),oe.removeEventListener("click",Pe),ie.removeEventListener("click",$e),oe.addEventListener("click",Pe),ie.addEventListener("click",$e)}function Pe(){Ge(d.uid)}function $e(){Je(d.uid)}function Q(){r.ref("posts").orderByChild("uid").equalTo(d.uid).once("value").then(e=>{const t=e.numChildren()||0;return r.ref("posts").once("value").then(n=>{let s=0;n.forEach(o=>{const i=o.val();i.comments&&Object.values(i.comments).forEach(a=>{a.uid===d.uid&&s++})}),vt.textContent=t+s})}).catch(e=>{m(`Error loading posts: ${e}`,"error")}),r.ref(`users/${d.uid}/followers`).once("value").then(e=>{oe.textContent=e.numChildren()||0}),r.ref(`users/${d.uid}/following`).once("value").then(e=>{ie.textContent=e.numChildren()||0})}function _(){Z.classList.add("hidden"),K.classList.add("hidden"),Z.textContent="",K.textContent=""}function le(e){Z.classList.remove("hidden"),Z.textContent=e}function At(e){K.classList.remove("hidden"),K.textContent=e}function Dt(e,t){let n;return function(...s){n&&clearTimeout(n),n=setTimeout(()=>{e.apply(this,s)},t)}}function ne(e){const t=document.createElement("div");return t.className="user-item",t.setAttribute("data-user-id",e.uid),t.innerHTML=`
      <div class="user-item-pic">
        ${e.profilePicture?`<img src="${e.profilePicture}">`:'<i class="fas fa-user"></i>'}
      </div>
      <div class="user-item-info">
        <div>${e.displayName}</div>
        <div class="text-secondary">@${e.username}</div>
      </div>
    `,t.addEventListener("click",()=>{N(e.uid)}),t}function Re(e,t){e.querySelectorAll(".ping-mention").forEach(n=>{n.addEventListener("click",function(s){const o=this.getAttribute("data-username");t(o)})})}function We(e,t){const n=Kt(e),{html:s,mediaHtmlArray:o}=Ot(n);let i=s,a=0;return i=i.replace(/<img[^>]*>|<video[^>]*>|<iframe[^>]*>/g,()=>a<o.length?o[a++]:""),i=i.replace(/@([a-zA-Z0-9_.-]+)/g,(c,l)=>{const u=w(l);return`<span class="ping-mention" data-username="${u}">@${u}</span>`}),`<div>${i}</div>`}function Ot(e){let t=w(e);const n=[],s=/https?:\/\/(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/)([A-Za-z0-9_\-]{11})/g;t=t.replace(s,(c,l)=>{const u=`<div class="embed-video"><iframe width="360" height="202" src="https://www.youtube.com/embed/${l}" frameborder="0" allowfullscreen></iframe></div>`;return n.push(u),`<iframe src="https://www.youtube.com/embed/${l}"></iframe>`});const o=/(https?:\/\/[^\s]+?\.(?:jpg|jpeg|png|gif|webp|bmp|svg))/gi;t=t.replace(o,(c,l)=>{const u=`<img src="${l}" class="embed-image" alt="Embedded Image" loading="lazy">`;return n.push(u),`<img src="${l}">`});const i=/(https?:\/\/[^\s]+?\.(?:mp4|webm|ogg))/gi;t=t.replace(i,(c,l)=>{const u=`<video class="embed-video" controls><source src="${l}" type="video/mp4">what how the freak does your browser no support video tag</video>`;return n.push(u),`<video src="${l}"></video>`});const a=new RegExp(`(?<!["'=\\]>])((https?:\\/\\/[^\\s<>"'()]+))`,"gi");return t=t.replace(a,(c,l)=>/<iframe|<img|<video/.test(c)?c:`<a href="${l}" target="_blank" rel="noopener noreferrer">${l}</a>`),n.length>1?{html:t,mediaHtmlArray:[`<div class="media-carousel">${n.join("")}</div>`]}:{html:t,mediaHtmlArray:n}}function Ze(e){e.addEventListener("input",function(t){const n=e.selectionStart,s=e.value.substring(0,n),o=e.value.substring(n),i=s.replace(/:([a-zA-Z0-9_]+):$/g,a=>{const c=a.toLowerCase();return Oe[c]||a});i!==s&&(e.value=i+o,e.selectionStart=e.selectionEnd=i.length)})}function M(e){const t=document.createElement("div");t.className="post",t.setAttribute("data-post-id",e.id),e.isComment&&(t.setAttribute("data-comment-id",e.id),t.setAttribute("data-parent-post-id",e.parentPostId),t.classList.add("comment-post"));const n=e.likes?Object.keys(e.likes).length:0,s=e.likes&&d&&e.likes[d.uid],o=e.reposts?Object.keys(e.reposts).length:0,i=e.reposts&&d&&e.reposts[d.uid],c=e.uid===(d==null?void 0:d.uid)?`
        <div class="post-menu">
            <button class="post-menu-btn"><i class="fas fa-ellipsis-h"></i></button>
            <div class="post-menu-options">
                <div class="post-menu-option delete">delete</div>
            </div>
        </div>
    `:"";let l="";e.repostNotice&&(l=`<div class="repost-notice">${e.repostNotice}</div>`);const u=We(e.content),p=e.parentPostId?`<div class="post-action" data-action="comment" title="View parent post">
            <i class="fas fa-arrow-up"></i>
        </div>`:`<div class="post-action" data-action="comment">
            <i class="far fa-comment"></i> <span>${e.commentCount||0}</span>
        </div>`;return t.innerHTML=`
      <div class="post-header">
        <div class="post-author-pic">
          ${e.profilePicture?`<img src="${e.profilePicture}">`:'<i class="fas fa-user"></i>'}
        </div>
        <div class="post-author-info">
          <span class="post-author-name">${e.displayName}</span>
          <span class="post-username">@${e.username}</span>
          <span class="post-timestamp">${Ye(e.timestamp)}</span>
        </div>
        ${c}
      </div>
      <div class="post-content">
        ${l}
        ${u}
      </div>
      <div class="post-actions">
        <div class="post-action${s?" liked":""}" data-action="like">
          <i class="fa${s?"s":"r"} fa-heart"></i> <span>${n}</span>
        </div>
        ${p}
        ${e.isComment?"":`
        <div class="post-action${i?" reposted":""}" data-action="repost">
          <i class="fas fa-retweet"></i> <span>${o}</span>
        </div>
        `}
      </div>
    `,Re(t,Ke),Yt(t,e),t}function Ke(e){r.ref(`usernames/${e}`).once("value").then(t=>{if(t.exists()){const n=t.val();N(n)}else m("user not found: @"+e,"error")})}function Ye(e){const n=Date.now()-e,s=60*1e3,o=60*s,i=24*o,a=7*i,c=30*i,l=365*i;return n<s?`${Math.floor(n/1e3)}s ago`:n<o?`${Math.floor(n/s)}m ago`:n<i?`${Math.floor(n/o)}h ago`:n<a?`${Math.floor(n/i)}d ago`:n<c?`${Math.floor(n/a)}w ago`:n<l?`${Math.floor(n/c)}mo ago`:`${Math.floor(n/l)}y ago`}function jt(e){const t=document.querySelector(`.post[data-post-id="${e}"]`),n=t==null?void 0:t.classList.contains("comment-post"),s=t==null?void 0:t.getAttribute("data-parent-post-id");confirm("are you sure you want to delete this "+(n?"comment":"post")+"?")&&(n&&s?r.ref(`posts/${s}/comments/${e}`).remove().then(()=>r.ref(`posts/${s}/commentCount`).once("value")).then(o=>{const i=o.val()||0;return r.ref(`posts/${s}/commentCount`).set(Math.max(i-1,0))}).then(()=>{m("comment deleted successfully","success"),Y()}).catch(o=>{m(`error deleting comment: ${o}`,"error")}):r.ref(`posts/${e}`).once("value").then(o=>{const i=o.val();if(i&&i.repost&&i.repost.postId&&i.uid===d.uid){const a=i.repost.postId;r.ref(`posts/${a}/reposts/${d.uid}`).remove(),r.ref(`posts/${a}/repostCount`).transaction(c=>Math.max((c||1)-1,0))}return r.ref(`posts/${e}`).remove()}).then(()=>{m("post deleted successfully","success"),Y()}).catch(o=>{m(`error deleting post: ${o}`,"error")}))}function qt(e){if(!d)return;const t=r.ref(`posts/${e}/likes/${d.uid}`);t.once("value").then(n=>{n.exists()?t.remove():t.set(!0);const s=document.querySelector(`.post[data-post-id="${e}"]`);s&&Xe(s,!n.exists())})}function Xe(e,t){const n=e.querySelector('[data-action="like"]');if(n){const s=n.querySelector("i"),o=n.querySelector("span"),i=parseInt(o.textContent||"0");t?(n.classList.add("liked"),s.classList.remove("far"),s.classList.add("fas"),o.textContent=i+1):(n.classList.remove("liked"),s.classList.remove("fas"),s.classList.add("far"),o.textContent=Math.max(i-1,0))}}document.getElementById("comment-button").addEventListener("click",function(){const e=document.getElementById("comment-input").value.trim(),t=document.querySelector("#post-detail-page .post").dataset.postId;e&&tt().then(n=>{if(nt(e,n)){m("your comment contains a blocked word, please revise and try again","error");return}r.ref(`posts/${t}/comments`).push().set({uid:d.uid,username:g.username,profilePicture:g.profilePicture,text:e,timestamp:Date.now()}).then(()=>(document.getElementById("comment-input").value="",r.ref(`posts/${t}/commentCount`).once("value"))).then(o=>{const i=o.val()||0;return r.ref(`posts/${t}/commentCount`).set(i+1)}).then(()=>{ue(t)})})});function _t(e,t){t?ce(e,t):ce(e)}function N(e){if($=e,d&&e===d.uid){x("profile"),Q(),j(d.uid);return}r.ref(`users/${e}`).once("value").then(t=>{if(t.val()){const n=t.val();Et.textContent=n.displayName,Lt.textContent=`@${n.username}`,ht.textContent=n.bio||"no bio...",n.profilePicture?(Le.classList.add("hidden"),z.classList.remove("hidden"),z.src=n.profilePicture):(Le.classList.remove("hidden"),z.classList.add("hidden"),z.src=""),ae.removeEventListener("click",Ce),re.removeEventListener("click",ke),ae.addEventListener("click",Ce),re.addEventListener("click",ke),x("userProfile"),et(e),j(e),ge(e)}else m("user not found","error")})}function Ce(){Ge($)}function ke(){Je($)}function Ge(e){const t=Qe(e,"followers");document.body.appendChild(t),Ft(e,t)}function Je(e){const t=Qe(e,"following");document.body.appendChild(t),Ut(e,t)}function Qe(e,t){const n=document.querySelector(".followers-modal");n&&n.remove();const s=document.createElement("div");return s.className="followers-modal",s.innerHTML=`
        <div class="followers-modal-backdrop"></div>
        <div class="followers-modal-content">
            <div class="followers-modal-header">
                <h3>${t==="followers"?"Followers":"Following"}</h3>
                <button class="followers-modal-close">&times;</button>
            </div>
            <div class="followers-modal-body">
                <div class="loading"><div class="loading-spinner"></div></div>
            </div>
        </div>
    `,s.querySelector(".followers-modal-backdrop").addEventListener("click",()=>{s.remove()}),s.querySelector(".followers-modal-close").addEventListener("click",()=>{s.remove()}),s}function Ft(e,t){const n=t.querySelector(".followers-modal-body");n.innerHTML='<div class="loading"><div class="loading-spinner"></div></div>',r.ref(`users/${e}/followers`).once("value").then(s=>{const o=s.val()||{},i=Object.keys(o);if(i.length===0){n.innerHTML='<div class="no-followers">No followers yet</div>';return}return Promise.all(i.map(a=>r.ref(`users/${a}`).once("value")))}).then(s=>{if(!s)return;const o=s.map(i=>i.val()).filter(i=>i!==null);if(n.innerHTML="",o.length===0){n.innerHTML='<div class="no-followers">No followers yet</div>';return}o.forEach(i=>{const a=Ve(i);n.appendChild(a)})}).catch(s=>{m(`error loading followers: ${s}`,"error"),n.innerHTML='<div class="error-message">Failed to load followers</div>'})}function Ut(e,t){const n=t.querySelector(".followers-modal-body");n.innerHTML='<div class="loading"><div class="loading-spinner"></div></div>',r.ref(`users/${e}/following`).once("value").then(s=>{const o=s.val()||{},i=Object.keys(o);if(i.length===0){n.innerHTML='<div class="no-followers">Not following anyone yet</div>';return}return Promise.all(i.map(a=>r.ref(`users/${a}`).once("value")))}).then(s=>{if(!s)return;const o=s.map(i=>i.val()).filter(i=>i!==null);if(n.innerHTML="",o.length===0){n.innerHTML='<div class="no-followers">Not following anyone yet</div>';return}o.forEach(i=>{const a=Ve(i);n.appendChild(a)})}).catch(s=>{m(`error loading following list: ${s}`,"error"),n.innerHTML='<div class="error-message">Failed to load following list</div>'})}function Ve(e){const t=document.createElement("div");return t.className="follower-item",t.innerHTML=`
        <div class="follower-pic">
            ${e.profilePicture?`<img src="${e.profilePicture}" alt="${e.username}">`:'<i class="fas fa-user"></i>'}
        </div>
        <div class="follower-info">
            <div class="follower-name">${e.displayName}</div>
            <div class="follower-username">@${e.username}</div>
        </div>
    `,t.addEventListener("click",()=>{var n;(n=document.querySelector(".followers-modal"))==null||n.remove(),N(e.uid)}),t}function ge(e){r.ref("posts").orderByChild("uid").equalTo(e).once("value").then(t=>{const n=t.numChildren()||0;return r.ref("posts").once("value").then(s=>{let o=0;s.forEach(i=>{const a=i.val();a.comments&&Object.values(a.comments).forEach(c=>{c.uid===e&&o++})}),bt.textContent=n+o})}).catch(t=>{m(`Error loading user posts: ${t}`,"error")}),r.ref(`users/${e}/followers`).once("value").then(t=>{ae.textContent=t.numChildren()||0}),r.ref(`users/${e}/following`).once("value").then(t=>{re.textContent=t.numChildren()||0})}function et(e){if(d&&e&&e===d.uid){T.style.display="none";return}T.style.display="",r.ref(`users/${d.uid}/following/${e}`).once("value").then(t=>{t.exists()?T.textContent="Unfollow":T.textContent="Follow"})}function zt(e){if(!d)return;const t=r.ref(`users/${d.uid}/following/${e}`),n=r.ref(`users/${e}/followers/${d.uid}`);t.once("value").then(s=>{s.exists()?(t.remove(),n.remove()):(t.set(!0),n.set(!0)),et(e),Q(),ge(e)})}function tt(){return r.ref("blockedWords").once("value").then(e=>{const t=e.val();return t?Object.keys(t).map(n=>n.toLowerCase()):[]})}function nt(e,t){if(!Array.isArray(t)||t.length===0)return!1;const n="\\b("+t.map(o=>o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("|")+")\\b";return new RegExp(n,"i").test(e)}function Rt(e,t){if(d){if(t.uid===d.uid){m("you cannot repost your own post..","warning");return}r.ref(`posts/${e}/reposts/${d.uid}`).once("value").then(n=>{if(n.exists()){m("u already reposted this..","warning");return}r.ref(`posts/${e}/reposts/${d.uid}`).set(!0);const s=t.content||"",o=t.displayName||t.username,i=t.username,a=`<i class="fas fa-retweet"></i> <b>${w(g.displayName)}</b> reposted <b>@${w(i)}</b>'s post`,c={uid:d.uid,username:g.username,displayName:g.displayName,profilePicture:g.profilePicture||"",content:s,repostNotice:a,repost:{postId:e,originalAuthor:o,originalUsername:i},likes:{},commentCount:0,timestamp:Date.now()};r.ref("posts").push(c).then(()=>{r.ref(`posts/${e}/repostCount`).transaction(l=>(l||0)+1),m("Reposted!!","success"),Y()})})}}function m(e,t=""){const n=document.getElementById("toast-container");if(!n)return;const s=document.createElement("div");s.className=`toast${t?" "+t:""}`,s.innerHTML=`
        <span>${e}</span>
        <button class="toast-close" title="close">Ã—</button>
    `,setTimeout(()=>s.classList.add("show"),10);const o=setTimeout(()=>{s.classList.remove("show"),setTimeout(()=>s.remove(),300)},3500);s.querySelector(".toast-close").onclick=i=>{clearTimeout(o),s.classList.remove("show"),setTimeout(()=>s.remove(),300)},n.appendChild(s)}function Wt(e){const t={};return e.forEach((n,s)=>{const o=n.tag.replace(/^#/,"");t[`poptags/${o}`]={count:n.count,users:n.users,rank:s+1,lastUpdated:Date.now(),displayTag:n.tag}}),r.ref().update(t)}function Zt(){r.ref("posts").on("value",n=>{let s=0;const o=n.val()||{};Object.values(o).forEach(i=>{s++,i.comments&&(s+=Object.keys(i.comments).length)}),document.getElementById("total-posts-count").textContent=s}),r.ref("users").on("value",n=>{const s=n.numChildren();document.getElementById("total-users-count").textContent=s});const e=()=>{r.ref("posts").orderByChild("timestamp").limitToLast(500).once("value",n=>{const s=n.val()||{},o={},i={};Object.values(s).forEach(l=>{if(l.content){const u=l.content.match(/#\w+/g)||[];[...new Set(u)].forEach(h=>{const f=h.toLowerCase();o[f]=(o[f]||0)+1,l.uid&&(i[f]||(i[f]=new Set),i[f].add(l.uid))})}l.comments&&Object.values(l.comments).forEach(u=>{if(u.text){const p=u.text.match(/#\w+/g)||[];[...new Set(p)].forEach(f=>{const y=f.toLowerCase();o[y]=(o[y]||0)+1,u.uid&&(i[y]||(i[y]=new Set),i[y].add(u.uid))})}})});const c=Object.keys(i).filter(l=>i[l].size>=2).sort((l,u)=>o[u]-o[l]).slice(0,5).map(l=>({tag:l,count:o[l],users:i[l].size}));Wt(c).then(()=>{t(c)})})},t=n=>{const s=document.getElementById("trending-tags-list");s.innerHTML="",n.forEach(({tag:o,count:i,users:a})=>{const c=document.createElement("div");c.className="trending-tag",c.innerHTML=`
                ${o} <span class="tag-stats">(${i} posts, ${a} users)</span>
            `,c.addEventListener("click",()=>{se.value=o,fe(o),x("explore")}),s.appendChild(c)})};e(),r.ref("poptags").orderByChild("rank").limitToFirst(5).once("value",n=>{const s=n.val();if(s){const o=Object.entries(s).map(([i,a])=>({tag:a.displayTag||`#${i}`,count:a.count,users:a.users})).sort((i,a)=>a.count-i.count);t(o)}}),setInterval(e,12e4)}const V=document.getElementById("media-overlay"),Be=V.querySelector(".media-overlay-backdrop"),de=document.getElementById("media-overlay-inner"),xe=document.getElementById("media-overlay-close"),Ie=document.getElementById("media-zoom-in"),Te=document.getElementById("media-zoom-out"),Me=document.getElementById("media-zoom-reset");let C=null,b=1,L={x:0,y:0},q=!1,H={x:0,y:0},S={x:0,y:0};function Ne({src:e,type:t,poster:n}){de.innerHTML="",b=1,L={x:0,y:0};let s;t==="image"?(s=document.createElement("img"),s.src=e,s.alt="",s.draggable=!1,s.onload=function(){W()}):t==="video"&&(s=document.createElement("video"),s.src=e,s.controls=!0,n&&(s.poster=n),s.style.background="#000",s.onloadeddata=function(){W()}),C=s,de.appendChild(s),V.classList.remove("hidden"),document.body.classList.add("media-overlay-active"),W(),s.addEventListener("mousedown",function(o){q=!0,H={x:o.clientX,y:o.clientY},S={...L},s.style.cursor="grabbing",o.preventDefault()}),window.addEventListener("mousemove",st),window.addEventListener("mouseup",X),s.addEventListener("touchstart",function(o){o.touches.length===1&&(q=!0,H={x:o.touches[0].clientX,y:o.touches[0].clientY},S={...L})}),window.addEventListener("touchmove",ot,{passive:!1}),window.addEventListener("touchend",X),s.addEventListener("wheel",function(o){o.preventDefault(),o.deltaY<0?it():at()})}function st(e){!q||!C||(L.x=S.x+(e.clientX-H.x),L.y=S.y+(e.clientY-H.y),F())}function ot(e){!q||!C||e.touches.length!==1||(L.x=S.x+(e.touches[0].clientX-H.x),L.y=S.y+(e.touches[0].clientY-H.y),F(),e.preventDefault())}function X(){q=!1,C&&(C.style.cursor="grab")}function it(){b=Math.min(b+.2,5),F()}function at(){b=Math.max(b-.2,.2),F()}function W(){b=1,L={x:0,y:0},F()}function F(){C&&(C.style.transform=`scale(${b}) translate(${L.x/b}px, ${L.y/b}px)`)}function he(){V.classList.add("hidden"),document.body.classList.remove("media-overlay-active"),C=null,de.innerHTML="",window.removeEventListener("mousemove",st),window.removeEventListener("mouseup",X),window.removeEventListener("touchmove",ot),window.removeEventListener("touchend",X)}xe&&(xe.onclick=he);Be&&(Be.onclick=he);Ie&&(Ie.onclick=it);Te&&(Te.onclick=at);Me&&(Me.onclick=W);document.addEventListener("keydown",function(e){e.key==="Escape"&&!V.classList.contains("hidden")&&he()});document.addEventListener("click",function(e){e.target.matches(".embed-image")&&Ne({src:e.target.src,type:"image"}),e.target.matches(".embed-video video")&&Ne({src:e.target.src,type:"video",poster:e.target.poster}),e.target.matches(".embed-video iframe")&&window.open(e.target.src,"_blank")});function Kt(e){return e.replace(/:([a-zA-Z0-9_+-]+):/g,(t,n)=>Oe[n]||t)}function Yt(e,t){e.querySelectorAll(".post-author-name, .post-username, .post-author-pic").forEach(n=>{n.addEventListener("click",function(s){s.stopPropagation(),N(t.uid)})}),e.querySelectorAll(".post-menu-btn").forEach(n=>{n.addEventListener("click",function(s){s.stopPropagation(),this.nextElementSibling.classList.toggle("show")})}),e.querySelectorAll(".post-menu-option.delete").forEach(n=>{n.addEventListener("click",function(s){s.stopPropagation();const o=this.closest(".post").getAttribute("data-post-id");jt(o)})}),e.querySelectorAll(".post-action").forEach(n=>{n.addEventListener("click",function(s){const o=this.closest(".post"),i=o.getAttribute("data-post-id"),a=this.getAttribute("data-action");if(a==="like")if(o.classList.contains("comment-post")){const c=o.getAttribute("data-comment-id"),l=o.getAttribute("data-parent-post-id");Ue(l,c)}else qt(i);else if(a==="comment"){const c=this.closest(".post").getAttribute("data-parent-post-id");c?ce(c):_t(i,`@${t.username}`)}else a==="repost"&&Rt(i,t)})})}Ze(document.getElementById("post-input"));Ze(document.getElementById("comment-input"));setInterval(()=>{document.getElementById("comment-input").maxLength="512",document.getElementById("edit-bio").maxLength="160",document.getElementById("register-displayname").maxLength="20",document.getElementById("post-input").maxLength="512",document.getElementById("register-username").maxLength="20",document.getElementById("register-email").maxLength="100",document.getElementById("register-password").maxLength="100",document.getElementById("login-email").maxLength="100",document.getElementById("login-password").maxLength="100",document.getElementById("edit-display-name").maxLength="20",document.getElementById("edit-bio").maxLength="160"},10);
