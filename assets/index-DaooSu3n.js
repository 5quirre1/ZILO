(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();var P={};const rt={apiKey:P.apiKey,authDomain:P.authDomain,databaseURL:P.databaseUrl,projectId:P.projectId,storageBucket:P.storageBucket,messagingSenderId:P.messagingSenderId,appId:P.appId,measurementId:P.measurementId},He=document.getElementById("loading-screen");function ct(){He.style.display="flex"}function te(){He.style.display="none"}firebase.initializeApp(rt);const V=firebase.auth(),r=firebase.database(),G={home:{currentPage:1,totalPages:1,postsPerPage:10}};let d=null,f=null,C=null;const ye=document.getElementById("auth-container"),x=document.getElementById("login-form"),B=document.getElementById("register-form"),lt=document.getElementById("show-register"),dt=document.getElementById("show-login"),Z=document.getElementById("auth-error"),Y=document.getElementById("auth-success"),Ee=document.getElementById("app"),we=document.getElementById("post-input"),ut=document.getElementById("post-button"),k=document.getElementById("feed-posts"),mt=document.getElementById("profile-posts"),v=document.getElementById("users-list"),oe=document.getElementById("search-input"),O=document.getElementById("tagged-posts"),Se=document.getElementById("edit-bio"),ft=document.getElementById("profile-display-name"),pt=document.getElementById("profile-username"),gt=document.getElementById("profile-bio"),ht=document.getElementById("user-profile-bio"),Le=document.getElementById("profile-pic-placeholder"),z=document.getElementById("profile-pic-img"),vt=document.getElementById("profile-posts-count"),ie=document.getElementById("profile-followers-count"),ae=document.getElementById("profile-following-count"),yt=document.getElementById("change-profile-pic"),Et=document.getElementById("edit-profile-form"),Ae=document.getElementById("edit-display-name"),Oe=document.getElementById("edit-profile-pic"),K={home:document.getElementById("nav-home"),explore:document.getElementById("nav-explore"),profile:document.getElementById("nav-profile"),tagged:document.getElementById("nav-tagged"),settings:document.getElementById("nav-settings"),logout:document.getElementById("nav-logout")},De={":sob:":"ðŸ˜­",":smile:":"ðŸ˜ƒ",":heart:":"â¤ï¸",":broken_heart:":"ðŸ’”",":thumbsup:":"ðŸ‘",":thumbsdown:":"ðŸ‘Ž",":fire:":"ðŸ”¥",":laughing:":"ðŸ˜†",":confused:":"ðŸ˜•",":cry:":"ðŸ˜¢",":sweat:":"ðŸ˜…",":sweat_smile:":"ðŸ˜…",":joy:":"ðŸ˜‚",":sunglasses:":"ðŸ˜Ž",":star_struck:":"ðŸ¤©",":thinking:":"ðŸ¤”",":sleeping:":"ðŸ˜´",":pensive:":"ðŸ˜”",":grin:":"ðŸ˜",":wink:":"ðŸ˜‰",":kiss:":"ðŸ˜˜",":yum:":"ðŸ˜‹",":clap:":"ðŸ‘",":wave:":"ðŸ‘‹",":muscle:":"ðŸ’ª",":raised_hands:":"ðŸ™Œ",":pray:":"ðŸ™",":sparkles:":"âœ¨",":biceps:":"ðŸ’ª",":robot:":"ðŸ¤–",":alien:":"ðŸ‘½",":unicorn:":"ðŸ¦„",":santa:":"ðŸŽ…",":party:":"ðŸ¥³",":exploding_head:":"ðŸ¤¯",":shushing:":"ðŸ¤«",":nerd:":"ðŸ¤“",":woozy:":"ðŸ¥´",":facepalm:":"ðŸ¤¦",":mind_blown:":"ðŸ¤¯",":innocent:":"ðŸ˜‡",":speaking_head:":"ðŸ—£ï¸",":fearful:":"ðŸ˜¨",":face_with_thermometer:":"ðŸ¤’",":face_with_head_bandage:":"ðŸ¤•",":vomiting_face:":"ðŸ¤®",":nauseated_face:":"ðŸ¤¢",":cold_face:":"ðŸ¥¶",":hot_face:":"ðŸ¥µ",":zany:":"ðŸ¤ª",":relieved:":"ðŸ˜Œ",":hugging:":"ðŸ¤—",":rolling_eyes:":"ðŸ™„",":expressionless:":"ðŸ˜‘",":ok_hand:":"ðŸ‘Œ",":crossed_fingers:":"ðŸ¤ž",":v:":"âœŒï¸",":fist:":"âœŠ",":call_me:":"ðŸ¤™",":pinching_hand:":"ðŸ¤",":raised_back_of_hand:":"ðŸ¤š",":handshake:":"ðŸ¤",":birthday:":"ðŸŽ‚",":champagne:":"ðŸ¾",":pizza:":"ðŸ•",":hamburger:":"ðŸ”",":popcorn:":"ðŸ¿",":taco:":"ðŸŒ®",":coffee:":"â˜•",":beer:":"ðŸº",":wine_glass:":"ðŸ·",":cake:":"ðŸ°",":cocktail:":"ðŸ¸",":donut:":"ðŸ©",":cookie:":"ðŸª",":chocolate:":"ðŸ«",":fries:":"ðŸŸ",":icecream:":"ðŸ¦",":sushi:":"ðŸ£",":hotdog:":"ðŸŒ­",":avocado:":"ðŸ¥‘",":banana:":"ðŸŒ",":apple:":"ðŸŽ",":grapes:":"ðŸ‡",":carrot:":"ðŸ¥•",":bread:":"ðŸž",":bento:":"ðŸ±",":rose:":"ðŸŒ¹",":sunflower:":"ðŸŒ»",":bouquet:":"ðŸ’",":leaf:":"ðŸƒ",":dog:":"ðŸ¶",":cat:":"ðŸ±",":panda:":"ðŸ¼",":monkey:":"ðŸµ",":turtle:":"ðŸ¢",":whale:":"ðŸ³",":shark:":"ðŸ¦ˆ",":rabbit:":"ðŸ°",":fox:":"ðŸ¦Š",":bear:":"ðŸ»",":elephant:":"ðŸ˜",":dragon:":"ðŸ‰",":owl:":"ðŸ¦‰",":bee:":"ðŸ",":ladybug:":"ðŸž",":snake:":"ðŸ",":cactus:":"ðŸŒµ",":volcano:":"ðŸŒ‹",":soccer:":"âš½",":basketball:":"ðŸ€",":football:":"ðŸˆ",":tennis:":"ðŸŽ¾",":guitar:":"ðŸŽ¸",":microphone:":"ðŸŽ¤",":video_game:":"ðŸŽ®",":headphones:":"ðŸŽ§",":camera:":"ðŸ“·",":computer:":"ðŸ’»",":phone:":"ðŸ“±",":lightbulb:":"ðŸ’¡",":books:":"ðŸ“š",":notebook:":"ðŸ““",":calendar:":"ðŸ“…",":toolbox:":"ðŸ§°",":hammer:":"ðŸ”¨",":paintbrush:":"ðŸ–Œï¸",":wrench:":"ðŸ”§",":flashlight:":"ðŸ”¦",":sun:":"â˜€ï¸",":cloud:":"â˜ï¸",":rain:":"ðŸŒ§ï¸",":snow:":"â„ï¸",":thunder:":"ðŸŒ©ï¸",":umbrella:":"â˜”",":airplane:":"âœˆï¸",":car:":"ðŸš—",":rocket:":"ðŸš€",":train:":"ðŸš†",":globe:":"ðŸŒ",":mountain:":"â›°ï¸",":beach:":"ðŸ–ï¸",":tent:":"â›º",":check:":"âœ”ï¸",":x:":"âŒ",":warning:":"âš ï¸",":question:":"â“",":exclamation:":"â—",":100:":"ðŸ’¯",":money:":"ðŸ’°",":crown:":"ðŸ‘‘",":lock:":"ðŸ”’",":unlock:":"ðŸ”“",":key:":"ðŸ”‘",":rainbow:":"ðŸŒˆ",":star:":"â­",":boom:":"ðŸ’¥",":hourglass:":"â³",":gem:":"ðŸ’Ž",":balloon:":"ðŸŽˆ",":gift:":"ðŸŽ",":label:":"ðŸ·ï¸",":trophy:":"ðŸ†",":medal:":"ðŸ…",":dice:":"ðŸŽ²",":clover:":"ðŸ€",":peace:":"â˜®ï¸",":wilted-rose:":"ðŸ¥€"},D={home:document.getElementById("home-page"),explore:document.getElementById("explore-page"),profile:document.getElementById("profile-page"),tagged:document.getElementById("tagged-page"),settings:document.getElementById("settings-page"),userProfile:document.getElementById("user-profile-page"),postDetail:document.getElementById("post-detail-page")},wt=document.getElementById("user-profile-display-name"),Lt=document.getElementById("user-profile-username"),be=document.getElementById("user-profile-pic-placeholder"),R=document.getElementById("user-profile-pic-img"),bt=document.getElementById("user-profile-posts-count"),re=document.getElementById("user-profile-followers-count"),ce=document.getElementById("user-profile-following-count"),M=document.getElementById("follow-user-btn"),_e=document.getElementById("prev-page"),je=document.getElementById("next-page"),Pt=document.getElementById("current-page"),kt=document.getElementById("total-pages"),T=document.getElementById("page-numbers"),_=document.getElementById("home-pagination");_e.addEventListener("click",()=>qe("prev"));je.addEventListener("click",()=>qe("next"));function qe(e){const t=G.home;let n=t.currentPage;if(e==="prev"&&t.currentPage>1)n=t.currentPage-1;else if(e==="next"&&t.currentPage<t.totalPages)n=t.currentPage+1;else return;_.classList.add("hidden"),k.innerHTML='<div class="pagination-loading"><div class="loading-spinner"></div></div>',fe(n)}function ne(e){e<1||e>G.home.totalPages||(_.classList.add("hidden"),k.innerHTML='<div class="pagination-loading"><div class="loading-spinner"></div></div>',fe(e))}function Ct(){const e=G.home;Pt.textContent=e.currentPage,kt.textContent=e.totalPages,_e.disabled=e.currentPage===1,je.disabled=e.currentPage===e.totalPages,T.innerHTML="";const t=document.createElement("div");if(t.className=`page-number ${e.currentPage===1?"active":""}`,t.textContent="1",t.addEventListener("click",()=>ne(1)),T.appendChild(t),e.currentPage>3){const o=document.createElement("div");o.className="page-number",o.textContent="...",o.style.cursor="default",T.appendChild(o)}let n=Math.max(2,e.currentPage-1),s=Math.min(e.totalPages-1,e.currentPage+1);e.currentPage===2?s=Math.min(4,e.totalPages-1):e.currentPage===e.totalPages-1&&(n=Math.max(e.totalPages-2,2));for(let o=n;o<=s;o++){const i=document.createElement("div");i.className=`page-number ${e.currentPage===o?"active":""}`,i.textContent=o,i.addEventListener("click",()=>ne(o)),T.appendChild(i)}if(s<e.totalPages-1){const o=document.createElement("div");o.className="page-number",o.textContent="...",o.style.cursor="default",T.appendChild(o)}if(e.totalPages>1){const o=document.createElement("div");o.className=`page-number ${e.currentPage===e.totalPages?"active":""}`,o.textContent=e.totalPages,o.addEventListener("click",()=>ne(e.totalPages)),T.appendChild(o)}_.classList.remove("hidden")}lt.addEventListener("click",function(e){e.preventDefault(),x.classList.add("hidden"),B.classList.remove("hidden"),U()});dt.addEventListener("click",function(e){e.preventDefault(),x.classList.remove("hidden"),B.classList.add("hidden"),U()});x.addEventListener("submit",function(e){e.preventDefault();const t=document.getElementById("login-email").value,n=document.getElementById("login-password").value;U(),V.signInWithEmailAndPassword(t,n).then(()=>{m("Welcome back!!","success"),x.reset(),window.location.reload()}).catch(s=>{de(s.message)})});function w(e){return e.replace(/[^a-zA-Z0-9_.-]/g,"")}B.addEventListener("submit",function(e){e.preventDefault();const t=document.getElementById("register-username").value,n=w(t),s=document.getElementById("register-displayname").value,o=w(s),i=document.getElementById("register-email").value,a=document.getElementById("register-password").value;U(),r.ref("usernames/"+n).once("value").then(c=>{if(c.exists()){de(`${n} is already taken.. try another..`);return}return V.createUserWithEmailAndPassword(i,a).then(l=>{const u=l.user,g={uid:u.uid,username:n,displayName:o,email:i,profilePicture:"",createdAt:Date.now()},h={};return h[`users/${u.uid}`]=g,h[`usernames/${n}`]=u.uid,r.ref().update(h)}).then(()=>{B.reset(),At("account made"),m("Welcome to ZILO!!","success"),window.location.reload(),x.classList.remove("hidden"),B.classList.add("hidden")})}).catch(c=>{de(c.message)})});V.onAuthStateChanged(e=>{ct(),e?(d=e,r.ref(`users/${e.uid}`).once("value").then(t=>{f=t.val(),ge(f),ye.classList.add("hidden"),Ee.classList.remove("hidden"),X(),Wt(),te()}).catch(t=>{m(`error getting user data ${t}`,"error"),te()})):(d=null,f=null,ye.classList.remove("hidden"),Ee.classList.add("hidden"),x.reset(),B.reset(),x.classList.remove("hidden"),B.classList.add("hidden"),U(),te())});for(const[e,t]of Object.entries(K))t.addEventListener("click",function(n){if(n.preventDefault(),e==="logout"){V.signOut();return}I(e)});ut.addEventListener("click",$t);Et.addEventListener("submit",function(e){e.preventDefault(),Ht()});oe.addEventListener("input",Ot(function(){pe(oe.value)},300));yt.addEventListener("click",()=>{const e=prompt("enter the URL of your new profile picture:");e&&St(e)});M&&M.addEventListener("click",()=>{d&&C&&zt(C)});function I(e){for(const t of Object.values(D))t.classList.add("hidden");for(const t of Object.values(K))t.classList.remove("active");D[e]&&D[e].classList.remove("hidden"),K[e]&&K[e].classList.add("active"),Ue(e)}function X(){for(const[e,t]of Object.entries(D))if(!t.classList.contains("hidden")){Ue(e);return}I("home")}function Ue(e){switch(e){case"home":fe();break;case"explore":pe("");break;case"profile":j(d.uid),Q();break;case"tagged":Nt();break;case"settings":Ae.value=f.displayName||"",Oe.value=f.profilePicture||"",Se.value=f.bio||"";break;case"userProfile":C&&(j(C),he(C));break}}function $t(){const e=we.value.trim();e&&tt().then(t=>{if(nt(e,t)){m("your message contains a blocked word, please revise and try again","error");return}const n={uid:d.uid,username:f.username,displayName:f.displayName,profilePicture:f.profilePicture||"",content:e,likes:{},commentCount:0,timestamp:Date.now()},s=Bt(e);s.length>0&&(n.mentions=s);const o=r.ref("posts").push();o.set(n).then(()=>{we.value="",s.length>0&&xt(s,o.key),m("post created successfully!!","success"),setTimeout(()=>{I("profile"),j(d.uid)},1e3)}).catch(i=>{m(`error creating post: ${i}`,"error")})})}function Bt(e){const t=/@([a-zA-Z0-9_.-]+)/g,n=e.match(t);return n?n.map(s=>s.substring(1)):[]}function xt(e,t,n){[...new Set(e)].forEach(o=>{r.ref(`usernames/${o}`).once("value").then(i=>{i.exists()&&(i.val(),d.uid)})})}function E(e){return typeof e!="string"?"":e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/\n/g,"<br>")}function le(e,t){r.ref(`posts/${e}`).once("value").then(n=>{if(n.exists()){const s={id:e,...n.val()},o=document.querySelector("#post-detail-page .post-container");o.innerHTML="",o.appendChild(N(s)),me(e),I("postDetail"),t?(document.getElementById("comment-input").value=t+" ",document.getElementById("comment-input").focus()):document.getElementById("comment-input").value=""}})}function me(e){const t=document.getElementById("comments-container");t.innerHTML='<div class="loading"><div class="loading-spinner"></div></div>',r.ref(`posts/${e}/comments`).orderByChild("timestamp").once("value").then(n=>{t.innerHTML="",n.exists()?n.forEach(s=>{const o=s.val(),i=s.key,a=It(o,i,e);t.appendChild(a)}):t.innerHTML=`<div class="no-comments">chirp chirp.. there's nothing here..</div>`})}function It(e,t,n){const s=document.createElement("div");s.className="comment",s.setAttribute("data-comment-id",t),s.setAttribute("data-post-id",n);const o=e.likes?Object.keys(e.likes).length:0,i=e.likes&&d&&e.likes[d.uid],a=d&&e.uid===d.uid,c=a?'<button class="comment-delete-btn" title="delete comment"><i class="fas fa-trash"></i></button>':"",l=`<button class="comment-like-btn${i?" liked":""}" title="like comment">
        <i class="fa${i?"s":"r"} fa-heart"></i> <span>${o}</span>
    </button>`,u='<button class="comment-mention-btn" title="mention user"><i class="fas fa-at"></i></button>',g=Ke(e.text);s.innerHTML=`
        <div class="comment-avatar">
            ${e.profilePicture?`<img src="${e.profilePicture}" alt="${e.username}">`:'<i class="fas fa-user"></i>'}
        </div>
        <div class="comment-main">
            <div class="comment-header">
                <div class="comment-info">
                    <span class="comment-username">${e.username}</span>
                    <span class="comment-time">${Ye(e.timestamp)}</span>
                </div>
                <div class="comment-actions">
                    ${l}
                    ${u}
                    ${c}
                </div>
            </div>
            <div class="comment-content">${g}</div>
        </div>
    `,Re(s,Ze),s.querySelector(".comment-like-btn").addEventListener("click",function(y){y.stopPropagation(),Fe(n,t)}),a&&s.querySelector(".comment-delete-btn").addEventListener("click",function(y){y.stopPropagation(),Tt(n,t)}),s.querySelector(".comment-mention-btn").addEventListener("click",function(y){y.stopPropagation(),document.getElementById("comment-input").value=`@${e.username} `,document.getElementById("comment-input").focus()});const h=s.querySelector(".comment-avatar"),p=s.querySelector(".comment-username");return h&&h.addEventListener("click",y=>{y.stopPropagation(),H(e.uid)}),p&&p.addEventListener("click",y=>{y.stopPropagation(),H(e.uid)}),s}function Tt(e,t){confirm("are ya sure u want to delete this comment?")&&r.ref(`posts/${e}/comments/${t}`).remove().then(()=>r.ref(`posts/${e}/commentCount`).once("value")).then(n=>{const s=n.val()||0;return r.ref(`posts/${e}/commentCount`).set(Math.max(s-1,0))}).then(()=>{m("comment deleted successfully","success"),me(e)}).catch(n=>{m(`error deleting comment, try again: ${n}`,"error")})}function Fe(e,t){if(!d)return;const n=r.ref(`posts/${e}/comments/${t}/likes/${d.uid}`);n.once("value").then(s=>{const o=s.exists();o?n.remove():n.set(!0);const i=!o;document.querySelectorAll(`
                .comment[data-comment-id="${t}"],
                .post.comment-post[data-comment-id="${t}"]
            `).forEach(c=>{c.classList.contains("comment")?Mt(c,i):Xe(c,i)})})}function Mt(e,t){const n=e.querySelector(".comment-like-btn");if(n){const s=n.querySelector("i"),o=n.querySelector("span"),i=parseInt(o.textContent||"0");t?(n.classList.add("liked"),s.classList.remove("far"),s.classList.add("fas"),o.textContent=i+1):(n.classList.remove("liked"),s.classList.remove("fas"),s.classList.add("far"),o.textContent=Math.max(i-1,0))}}function fe(e=1){k.innerHTML='<div class="loading"><div class="loading-spinner"></div></div>';let t=[];r.ref(`users/${d.uid}/following`).once("value").then(n=>{if(n.val()&&(t=Object.keys(n.val())),t.length===0){k.innerHTML='<div class="text-center text-muted py-5">follow some users to see posts!</div>',_.classList.add("hidden");return}const s=[],o=G.home,i=o.postsPerPage,a=t.map(c=>r.ref("posts").orderByChild("uid").equalTo(c).once("value").then(l=>{const u=l.val();u&&Object.entries(u).forEach(([g,h])=>{s.push({id:g,...h,likes:h.likes||{},displayName:E(h.displayName),username:w(h.username)})})}));return Promise.all(a).then(()=>{if(s.length===0){k.innerHTML='<div class="text-center text-muted py-5">follow some users to see posts!</div>',_.classList.add("hidden");return}s.sort((h,p)=>p.timestamp-h.timestamp);const c=s.length;o.totalPages=Math.ceil(c/i),o.currentPage=Math.min(e,o.totalPages);const l=(o.currentPage-1)*i,u=Math.min(l+i,c),g=s.slice(l,u);k.innerHTML="",g.forEach(h=>{const p=N(h);k.appendChild(p)}),Ct()})}).catch(n=>{m(`failed to load posts: ${n}`,"error"),k.innerHTML='<div class="alert alert-danger">failed to load posts, try again later..</div>'})}function j(e){const t=e===d.uid?mt:document.getElementById("user-profile-posts");t.innerHTML='<div class="loading"><div class="loading-spinner"></div></div>',r.ref("posts").orderByChild("uid").equalTo(e).once("value").then(n=>{const s=n.val()||{},o=Object.entries(s).map(([i,a])=>({id:i,...a,likes:a.likes||{},displayName:E(a.displayName),username:w(a.username)}));return r.ref("posts").once("value").then(i=>{const a=i.val()||{},c=[];Object.entries(a).forEach(([u,g])=>{g.comments&&Object.entries(g.comments).forEach(([h,p])=>{p.uid===e&&c.push({id:h,...p,parentPostId:u,isComment:!0,likes:p.likes||{},displayName:E(p.displayName||p.username),username:w(p.username),timestamp:p.timestamp,content:p.text})})});const l=[...o,...c];l.sort((u,g)=>g.timestamp-u.timestamp),t.innerHTML="",l.length>0?l.forEach(u=>{const g=N(u);u.isComment&&(g.classList.add("comment-post"),g.setAttribute("data-parent-post-id",u.parentPostId)),t.appendChild(g)}):t.innerHTML='<div class="text-center text-muted py-5">chrip chirp.. nothing here..</div>'})}).catch(n=>{m(`error loading user's posts: ${n}`,"error"),t.innerHTML='<div class="alert alert-danger">failed to load posts, try again later..</div>'})}function Nt(){O.innerHTML='<div class="loading"><div class="loading-spinner"></div></div>',r.ref("posts").orderByChild("timestamp").once("value").then(e=>{const t=[];e.val()&&Object.entries(e.val()).map(([s,o])=>({id:s,...o})).forEach(s=>{s.mentions&&s.mentions.includes(f.username)&&t.push(s)}),t.sort((n,s)=>s.timestamp-n.timestamp),O.innerHTML="",t.length>0?t.forEach(n=>{const s=N(n);O.appendChild(s)}):O.innerHTML='<div class="text-center text-muted py-5">no one has tagged you in a post yet..</div>'}).catch(e=>{m(`error fetching tagged posts: ${e}`,"error"),O.innerHTML='<div class="alert alert-danger">error fetching tagged posts, try again later</div>'})}function pe(e){if(e=e.trim(),e===""){r.ref("users").orderByChild("username").once("value").then(t=>{v.innerHTML="",t.val()?Object.values(t.val()).forEach(s=>{const o={...s,displayName:E(s.displayName),username:w(s.username)},i=se(o);v.appendChild(i)}):v.innerHTML='<div class="text-center text-muted py-3">No users found</div>'}).catch(t=>{m(`Error searching users: ${t}`,"error"),v.innerHTML='<div class="alert alert-danger">Failed to search for users, try again later</div>'});return}if(e.startsWith("@")){const t=e.substring(1).toLowerCase();r.ref("users").orderByChild("username").limitToFirst(50).once("value").then(n=>{if(v.innerHTML="",n.val()){const s=Object.values(n.val()).filter(o=>o.username.toLowerCase().includes(t));if(s.length===0){v.innerHTML='<div class="text-center text-muted py-3">No users found with this username</div>';return}s.forEach(o=>{const i={...o,displayName:E(o.displayName),username:w(o.username)},a=se(i);v.appendChild(a)})}else v.innerHTML='<div class="text-center text-muted py-3">No users found</div>'}).catch(n=>{m(`Error searching users: ${n}`,"error"),v.innerHTML='<div class="alert alert-danger">Failed to search for users, try again later</div>'})}else if(e.startsWith("#")){const t=e.toLowerCase();r.ref("posts").orderByChild("timestamp").once("value").then(n=>{v.innerHTML="";const s=n.val()||{},o=[];Object.entries(s).forEach(([i,a])=>{a.content&&a.content.toLowerCase().includes(t)&&o.push({id:i,...a,likes:a.likes||{},displayName:E(a.displayName),username:w(a.username)})}),o.length>0?(o.sort((i,a)=>a.timestamp-i.timestamp),v.innerHTML="",o.forEach(i=>{const a=N(i);v.appendChild(a)})):v.innerHTML='<div class="text-center text-muted py-3">No posts found with this tag</div>'})}else{const t=e.toLowerCase().split(" ");r.ref("posts").orderByChild("timestamp").once("value").then(n=>{v.innerHTML="";const s=n.val()||{},o=[];Object.entries(s).forEach(([i,a])=>{if(a.content){const c=a.content.toLowerCase();t.every(u=>c.includes(u))&&o.push({id:i,...a,likes:a.likes||{},displayName:E(a.displayName),username:w(a.username)})}}),o.length===0&&t.length>1&&Object.entries(s).forEach(([i,a])=>{if(a.content){const c=a.content.toLowerCase();t.some(u=>c.includes(u))&&o.push({id:i,...a,likes:a.likes||{},displayName:E(a.displayName),username:w(a.username)})}}),o.length>0?(o.sort((i,a)=>a.timestamp-i.timestamp),v.innerHTML="",o.forEach(i=>{const a=N(i);v.appendChild(a)})):r.ref("users").orderByChild("displayName").limitToFirst(50).once("value").then(i=>{if(i.val()){const a=Object.values(i.val()).filter(c=>c.displayName.toLowerCase().includes(e.toLowerCase())||c.username.toLowerCase().includes(e.toLowerCase()));a.length>0?(v.innerHTML="",a.forEach(c=>{const l={...c,displayName:E(c.displayName),username:w(c.username)},u=se(l);v.appendChild(u)})):v.innerHTML='<div class="text-center text-muted py-3">No posts or users found</div>'}else v.innerHTML='<div class="text-center text-muted py-3">No posts or users found</div>'})})}}function Ht(){const e=Ae.value.trim(),t=Oe.value.trim(),n=Se.value.trim();if(!e){m("please put a display name","warning");return}const s={};s[`users/${d.uid}/displayName`]=e,t&&(s[`users/${d.uid}/profilePicture`]=t),s[`users/${d.uid}/bio`]=n,r.ref().update(s).then(()=>{m("profile updated successfully!","success"),f.displayName=e,t&&(f.profilePicture=t),f.bio=n,ge(f),D.profile.classList.contains("hidden")||Q(),ze()}).catch(o=>{m(`error updating profile: ${o}`,"error")})}function St(e){r.ref(`users/${d.uid}/profilePicture`).set(e).then(()=>{f.profilePicture=e,ge(f),ze(),m("profile picture updated successfully!!","success")}).catch(t=>{m(`error updating profile picture: ${t}`,"error")})}function ze(){r.ref("posts").orderByChild("uid").equalTo(d.uid).once("value").then(e=>{if(e.val){const t={};Object.entries(e.val()).forEach(([n,s])=>{t[`posts/${n}/displayName`]=f.displayName,t[`posts/${n}/profilePicture`]=f.profilePicture||""}),r.ref().update(t)}}).catch(e=>m(`Error updating posts with new profile data: ${e}`,"error"))}function ge(e){ft.textContent=e.displayName,pt.textContent=`@${e.username}`,gt.textContent=e.bio||"add a bio in settings!!",e.profilePicture?(Le.classList.add("hidden"),z.classList.remove("hidden"),z.src=e.profilePicture):(Le.classList.remove("hidden"),z.classList.add("hidden"),z.src=""),ie.removeEventListener("click",Pe),ae.removeEventListener("click",ke),ie.addEventListener("click",Pe),ae.addEventListener("click",ke)}function Pe(){Je(d.uid)}function ke(){Ve(d.uid)}function Q(){r.ref("posts").orderByChild("uid").equalTo(d.uid).once("value").then(e=>{const t=e.numChildren()||0;return r.ref("posts").once("value").then(n=>{let s=0;n.forEach(o=>{const i=o.val();i.comments&&Object.values(i.comments).forEach(a=>{a.uid===d.uid&&s++})}),vt.textContent=t+s})}).catch(e=>{m(`Error loading posts: ${e}`,"error")}),r.ref(`users/${d.uid}/followers`).once("value").then(e=>{ie.textContent=e.numChildren()||0}),r.ref(`users/${d.uid}/following`).once("value").then(e=>{ae.textContent=e.numChildren()||0})}function U(){Z.classList.add("hidden"),Y.classList.add("hidden"),Z.textContent="",Y.textContent=""}function de(e){Z.classList.remove("hidden"),Z.textContent=e}function At(e){Y.classList.remove("hidden"),Y.textContent=e}function Ot(e,t){let n;return function(...s){n&&clearTimeout(n),n=setTimeout(()=>{e.apply(this,s)},t)}}function se(e){const t=document.createElement("div");return t.className="user-item",t.setAttribute("data-user-id",e.uid),t.innerHTML=`
      <div class="user-item-pic">
        ${e.profilePicture?`<img src="${e.profilePicture}">`:'<i class="fas fa-user"></i>'}
      </div>
      <div class="user-item-info">
        <div>${e.displayName}</div>
        <div class="text-secondary">@${e.username}</div>
      </div>
    `,t.addEventListener("click",()=>{H(e.uid)}),t}function Re(e,t){e.querySelectorAll(".ping-mention").forEach(n=>{n.addEventListener("click",function(s){const o=this.getAttribute("data-username");t(o)})})}function Ke(e,t){const n=Zt(e),{html:s,mediaHtmlArray:o}=Dt(n);let i=s,a=0;return i=i.replace(/<img[^>]*>|<video[^>]*>|<iframe[^>]*>/g,()=>a<o.length?o[a++]:""),i=i.replace(/@([a-zA-Z0-9_.-]+)/g,(c,l)=>{const u=E(l);return`<span class="ping-mention" data-username="${u}">@${u}</span>`}),`<div>${i}</div>`}function Dt(e){let t=E(e);const n=[],s=/https?:\/\/(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/)([A-Za-z0-9_\-]{11})/g;t=t.replace(s,(c,l)=>{const u=`<div class="embed-video"><iframe width="360" height="202" src="https://www.youtube.com/embed/${l}" frameborder="0" allowfullscreen></iframe></div>`;return n.push(u),`<iframe src="https://www.youtube.com/embed/${l}"></iframe>`});const o=/(https?:\/\/[^\s]+?\.(?:jpg|jpeg|png|gif|webp|bmp|svg))/gi;t=t.replace(o,(c,l)=>{const u=`<img src="${l}" class="embed-image" alt="Embedded Image" loading="lazy">`;return n.push(u),`<img src="${l}">`});const i=/(https?:\/\/[^\s]+?\.(?:mp4|webm|ogg))/gi;t=t.replace(i,(c,l)=>{const u=`<video class="embed-video" controls><source src="${l}" type="video/mp4">what how the freak does your browser no support video tag</video>`;return n.push(u),`<video src="${l}"></video>`});const a=new RegExp(`(?<!["'=\\]>])((https?:\\/\\/[^\\s<>"'()]+))`,"gi");return t=t.replace(a,(c,l)=>/<iframe|<img|<video/.test(c)?c:`<a href="${l}" target="_blank" rel="noopener noreferrer">${l}</a>`),n.length>1?{html:t,mediaHtmlArray:[`<div class="media-carousel">${n.join("")}</div>`]}:{html:t,mediaHtmlArray:n}}function We(e){e.addEventListener("input",function(t){const n=e.selectionStart,s=e.value.substring(0,n),o=e.value.substring(n),i=s.replace(/:([a-zA-Z0-9_]+):$/g,a=>{const c=a.toLowerCase();return De[c]||a});i!==s&&(e.value=i+o,e.selectionStart=e.selectionEnd=i.length)})}function N(e){const t=document.createElement("div");t.className="post",t.setAttribute("data-post-id",e.id),e.isComment&&(t.setAttribute("data-comment-id",e.id),t.setAttribute("data-parent-post-id",e.parentPostId),t.classList.add("comment-post"));const n=e.likes?Object.keys(e.likes).length:0,s=e.likes&&d&&e.likes[d.uid],o=e.reposts?Object.keys(e.reposts).length:0,i=e.reposts&&d&&e.reposts[d.uid],c=e.uid===(d==null?void 0:d.uid)?`
        <div class="post-menu">
            <button class="post-menu-btn"><i class="fas fa-ellipsis-h"></i></button>
            <div class="post-menu-options">
                <div class="post-menu-option delete">delete</div>
            </div>
        </div>
    `:"";let l="";e.repostNotice&&(l=`<div class="repost-notice">${e.repostNotice}</div>`);const u=Ke(e.content),g=e.parentPostId?`<div class="post-action" data-action="comment" title="View parent post">
            <i class="fas fa-arrow-up"></i>
        </div>`:`<div class="post-action" data-action="comment">
            <i class="far fa-comment"></i> <span>${e.commentCount||0}</span>
        </div>`;return t.innerHTML=`
      <div class="post-header">
        <div class="post-author-pic">
          ${e.profilePicture?`<img src="${e.profilePicture}">`:'<i class="fas fa-user"></i>'}
        </div>
        <div class="post-author-info">
          <span class="post-author-name">${e.displayName}</span>
          <span class="post-username">@${e.username}</span>
          <span class="post-timestamp">${Ye(e.timestamp)}</span>
        </div>
        ${c}
      </div>
      <div class="post-content">
        ${l}
        ${u}
      </div>
      <div class="post-actions">
        <div class="post-action${s?" liked":""}" data-action="like">
          <i class="fa${s?"s":"r"} fa-heart"></i> <span>${n}</span>
        </div>
        ${g}
        ${e.isComment?"":`
        <div class="post-action${i?" reposted":""}" data-action="repost">
          <i class="fas fa-retweet"></i> <span>${o}</span>
        </div>
        `}
      </div>
    `,Re(t,Ze),Yt(t,e),t}function Ze(e){r.ref(`usernames/${e}`).once("value").then(t=>{if(t.exists()){const n=t.val();H(n)}else m("user not found: @"+e,"error")})}function Ye(e){const n=Date.now()-e,s=60*1e3,o=60*s,i=24*o,a=7*i,c=30*i,l=365*i;return n<s?`${Math.floor(n/1e3)}s ago`:n<o?`${Math.floor(n/s)}m ago`:n<i?`${Math.floor(n/o)}h ago`:n<a?`${Math.floor(n/i)}d ago`:n<c?`${Math.floor(n/a)}w ago`:n<l?`${Math.floor(n/c)}mo ago`:`${Math.floor(n/l)}y ago`}function _t(e){const t=document.querySelector(`.post[data-post-id="${e}"]`),n=t==null?void 0:t.classList.contains("comment-post"),s=t==null?void 0:t.getAttribute("data-parent-post-id");confirm("are you sure you want to delete this "+(n?"comment":"post")+"?")&&(n&&s?r.ref(`posts/${s}/comments/${e}`).remove().then(()=>r.ref(`posts/${s}/commentCount`).once("value")).then(o=>{const i=o.val()||0;return r.ref(`posts/${s}/commentCount`).set(Math.max(i-1,0))}).then(()=>{m("comment deleted successfully","success"),X()}).catch(o=>{m(`error deleting comment: ${o}`,"error")}):r.ref(`posts/${e}`).once("value").then(o=>{const i=o.val();if(i&&i.repost&&i.repost.postId&&i.uid===d.uid){const a=i.repost.postId;r.ref(`posts/${a}/reposts/${d.uid}`).remove(),r.ref(`posts/${a}/repostCount`).transaction(c=>Math.max((c||1)-1,0))}return r.ref(`posts/${e}`).remove()}).then(()=>{m("post deleted successfully","success"),X()}).catch(o=>{m(`error deleting post: ${o}`,"error")}))}function jt(e){if(!d)return;const t=r.ref(`posts/${e}/likes/${d.uid}`);t.once("value").then(n=>{n.exists()?t.remove():t.set(!0);const s=document.querySelector(`.post[data-post-id="${e}"]`);s&&Xe(s,!n.exists())})}function Xe(e,t){const n=e.querySelector('[data-action="like"]');if(n){const s=n.querySelector("i"),o=n.querySelector("span"),i=parseInt(o.textContent||"0");t?(n.classList.add("liked"),s.classList.remove("far"),s.classList.add("fas"),o.textContent=i+1):(n.classList.remove("liked"),s.classList.remove("fas"),s.classList.add("far"),o.textContent=Math.max(i-1,0))}}document.getElementById("comment-button").addEventListener("click",function(){const e=document.getElementById("comment-input").value.trim(),t=document.querySelector("#post-detail-page .post").dataset.postId;e&&tt().then(n=>{if(nt(e,n)){m("your comment contains a blocked word, please revise and try again","error");return}r.ref(`posts/${t}/comments`).push().set({uid:d.uid,username:f.username,profilePicture:f.profilePicture,text:e,timestamp:Date.now()}).then(()=>(document.getElementById("comment-input").value="",r.ref(`posts/${t}/commentCount`).once("value"))).then(o=>{const i=o.val()||0;return r.ref(`posts/${t}/commentCount`).set(i+1)}).then(()=>{me(t)})})});function qt(e,t){t?le(e,t):le(e)}function H(e){if(C=e,d&&e===d.uid){I("profile"),Q(),j(d.uid);return}r.ref(`users/${e}`).once("value").then(t=>{if(t.val()){const n=t.val();wt.textContent=n.displayName,Lt.textContent=`@${n.username}`,ht.textContent=n.bio||"no bio...",n.profilePicture?(be.classList.add("hidden"),R.classList.remove("hidden"),R.src=n.profilePicture):(be.classList.remove("hidden"),R.classList.add("hidden"),R.src=""),re.removeEventListener("click",Ce),ce.removeEventListener("click",$e),re.addEventListener("click",Ce),ce.addEventListener("click",$e),I("userProfile"),et(e),j(e),he(e)}else m("user not found","error")})}function Ce(){Je(C)}function $e(){Ve(C)}function Je(e){const t=Ge(e,"followers");document.body.appendChild(t),Ut(e,t)}function Ve(e){const t=Ge(e,"following");document.body.appendChild(t),Ft(e,t)}function Ge(e,t){const n=document.querySelector(".followers-modal");n&&n.remove();const s=document.createElement("div");return s.className="followers-modal",s.innerHTML=`
        <div class="followers-modal-backdrop"></div>
        <div class="followers-modal-content">
            <div class="followers-modal-header">
                <h3>${t==="followers"?"Followers":"Following"}</h3>
                <button class="followers-modal-close">&times;</button>
            </div>
            <div class="followers-modal-body">
                <div class="loading"><div class="loading-spinner"></div></div>
            </div>
        </div>
    `,s.querySelector(".followers-modal-backdrop").addEventListener("click",()=>{s.remove()}),s.querySelector(".followers-modal-close").addEventListener("click",()=>{s.remove()}),s}function Ut(e,t){const n=t.querySelector(".followers-modal-body");n.innerHTML='<div class="loading"><div class="loading-spinner"></div></div>',r.ref(`users/${e}/followers`).once("value").then(s=>{const o=s.val()||{},i=Object.keys(o);if(i.length===0){n.innerHTML='<div class="no-followers">No followers yet</div>';return}return Promise.all(i.map(a=>r.ref(`users/${a}`).once("value")))}).then(s=>{if(!s)return;const o=s.map(i=>i.val()).filter(i=>i!==null);if(n.innerHTML="",o.length===0){n.innerHTML='<div class="no-followers">No followers yet</div>';return}o.forEach(i=>{const a=Qe(i);n.appendChild(a)})}).catch(s=>{m(`error loading followers: ${s}`,"error"),n.innerHTML='<div class="error-message">Failed to load followers</div>'})}function Ft(e,t){const n=t.querySelector(".followers-modal-body");n.innerHTML='<div class="loading"><div class="loading-spinner"></div></div>',r.ref(`users/${e}/following`).once("value").then(s=>{const o=s.val()||{},i=Object.keys(o);if(i.length===0){n.innerHTML='<div class="no-followers">Not following anyone yet</div>';return}return Promise.all(i.map(a=>r.ref(`users/${a}`).once("value")))}).then(s=>{if(!s)return;const o=s.map(i=>i.val()).filter(i=>i!==null);if(n.innerHTML="",o.length===0){n.innerHTML='<div class="no-followers">Not following anyone yet</div>';return}o.forEach(i=>{const a=Qe(i);n.appendChild(a)})}).catch(s=>{m(`error loading following list: ${s}`,"error"),n.innerHTML='<div class="error-message">Failed to load following list</div>'})}function Qe(e){const t=document.createElement("div");return t.className="follower-item",t.innerHTML=`
        <div class="follower-pic">
            ${e.profilePicture?`<img src="${e.profilePicture}" alt="${e.username}">`:'<i class="fas fa-user"></i>'}
        </div>
        <div class="follower-info">
            <div class="follower-name">${e.displayName}</div>
            <div class="follower-username">@${e.username}</div>
        </div>
    `,t.addEventListener("click",()=>{var n;(n=document.querySelector(".followers-modal"))==null||n.remove(),H(e.uid)}),t}function he(e){r.ref("posts").orderByChild("uid").equalTo(e).once("value").then(t=>{const n=t.numChildren()||0;return r.ref("posts").once("value").then(s=>{let o=0;s.forEach(i=>{const a=i.val();a.comments&&Object.values(a.comments).forEach(c=>{c.uid===e&&o++})}),bt.textContent=n+o})}).catch(t=>{m(`Error loading user posts: ${t}`,"error")}),r.ref(`users/${e}/followers`).once("value").then(t=>{re.textContent=t.numChildren()||0}),r.ref(`users/${e}/following`).once("value").then(t=>{ce.textContent=t.numChildren()||0})}function et(e){if(d&&e&&e===d.uid){M.style.display="none";return}M.style.display="",r.ref(`users/${d.uid}/following/${e}`).once("value").then(t=>{t.exists()?M.textContent="Unfollow":M.textContent="Follow"})}function zt(e){if(!d)return;const t=r.ref(`users/${d.uid}/following/${e}`),n=r.ref(`users/${e}/followers/${d.uid}`);t.once("value").then(s=>{s.exists()?(t.remove(),n.remove()):(t.set(!0),n.set(!0)),et(e),Q(),he(e)})}function tt(){return r.ref("blockedWords").once("value").then(e=>{const t=e.val();return t?Object.keys(t).map(n=>n.toLowerCase()):[]})}function nt(e,t){if(!Array.isArray(t)||t.length===0)return!1;const n="\\b("+t.map(o=>o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("|")+")\\b";return new RegExp(n,"i").test(e)}function Rt(e,t){if(d){if(t.uid===d.uid){m("you cannot repost your own post..","warning");return}r.ref(`posts/${e}/reposts/${d.uid}`).once("value").then(n=>{if(n.exists()){m("u already reposted this..","warning");return}r.ref(`posts/${e}/reposts/${d.uid}`).set(!0);const s=t.content||"",o=t.displayName||t.username,i=t.username,a=`<i class="fas fa-retweet"></i> <b>${E(f.displayName)}</b> reposted <b>@${E(i)}</b>'s post`,c={uid:d.uid,username:f.username,displayName:f.displayName,profilePicture:f.profilePicture||"",content:s,repostNotice:a,repost:{postId:e,originalAuthor:o,originalUsername:i},likes:{},commentCount:0,timestamp:Date.now()};r.ref("posts").push(c).then(()=>{r.ref(`posts/${e}/repostCount`).transaction(l=>(l||0)+1),m("Reposted!!","success"),X()})})}}function m(e,t=""){const n=document.getElementById("toast-container");if(!n)return;const s=document.createElement("div");s.className=`toast${t?" "+t:""}`,s.innerHTML=`
        <span>${e}</span>
        <button class="toast-close" title="close">Ã—</button>
    `,setTimeout(()=>s.classList.add("show"),10);const o=setTimeout(()=>{s.classList.remove("show"),setTimeout(()=>s.remove(),300)},3500);s.querySelector(".toast-close").onclick=i=>{clearTimeout(o),s.classList.remove("show"),setTimeout(()=>s.remove(),300)},n.appendChild(s)}function Kt(e){const t={};return e.forEach((n,s)=>{const o=n.tag.replace(/^#/,"");t[`poptags/${o}`]={count:n.count,users:n.users,rank:s+1,lastUpdated:Date.now(),displayTag:n.tag}}),r.ref().update(t)}function Wt(){r.ref("posts").on("value",n=>{let s=0;const o=n.val()||{};Object.values(o).forEach(i=>{s++,i.comments&&(s+=Object.keys(i.comments).length)}),document.getElementById("total-posts-count").textContent=s}),r.ref("users").on("value",n=>{const s=n.numChildren();document.getElementById("total-users-count").textContent=s});const e=()=>{r.ref("posts").orderByChild("timestamp").limitToLast(500).once("value",n=>{const s=n.val()||{},o={},i={};Object.values(s).forEach(l=>{if(l.content){const u=l.content.match(/#\w+/g)||[];[...new Set(u)].forEach(h=>{const p=h.toLowerCase();o[p]=(o[p]||0)+1,l.uid&&(i[p]||(i[p]=new Set),i[p].add(l.uid))})}l.comments&&Object.values(l.comments).forEach(u=>{if(u.text){const g=u.text.match(/#\w+/g)||[];[...new Set(g)].forEach(p=>{const y=p.toLowerCase();o[y]=(o[y]||0)+1,u.uid&&(i[y]||(i[y]=new Set),i[y].add(u.uid))})}})});const c=Object.keys(i).filter(l=>i[l].size>=2).sort((l,u)=>o[u]-o[l]).slice(0,5).map(l=>({tag:l,count:o[l],users:i[l].size}));Kt(c).then(()=>{t(c)})})},t=n=>{const s=document.getElementById("trending-tags-list");s.innerHTML="",n.forEach(({tag:o,count:i,users:a})=>{const c=document.createElement("div");c.className="trending-tag",c.innerHTML=`
                ${o} <span class="tag-stats">(${i} posts, ${a} users)</span>
            `,c.addEventListener("click",()=>{oe.value=o,pe(o),I("explore")}),s.appendChild(c)})};e(),r.ref("poptags").orderByChild("rank").limitToFirst(5).once("value",n=>{const s=n.val();if(s){const o=Object.entries(s).map(([i,a])=>({tag:a.displayTag||`#${i}`,count:a.count,users:a.users})).sort((i,a)=>a.count-i.count);t(o)}}),setInterval(e,12e4)}const ee=document.getElementById("media-overlay"),Be=ee.querySelector(".media-overlay-backdrop"),ue=document.getElementById("media-overlay-inner"),xe=document.getElementById("media-overlay-close"),Ie=document.getElementById("media-zoom-in"),Te=document.getElementById("media-zoom-out"),Me=document.getElementById("media-zoom-reset");let $=null,b=1,L={x:0,y:0},q=!1,S={x:0,y:0},A={x:0,y:0};function Ne({src:e,type:t,poster:n}){ue.innerHTML="",b=1,L={x:0,y:0};let s;t==="image"?(s=document.createElement("img"),s.src=e,s.alt="",s.draggable=!1,s.onload=function(){W()}):t==="video"&&(s=document.createElement("video"),s.src=e,s.controls=!0,n&&(s.poster=n),s.style.background="#000",s.onloadeddata=function(){W()}),$=s,ue.appendChild(s),ee.classList.remove("hidden"),document.body.classList.add("media-overlay-active"),W(),s.addEventListener("mousedown",function(o){q=!0,S={x:o.clientX,y:o.clientY},A={...L},s.style.cursor="grabbing",o.preventDefault()}),window.addEventListener("mousemove",st),window.addEventListener("mouseup",J),s.addEventListener("touchstart",function(o){o.touches.length===1&&(q=!0,S={x:o.touches[0].clientX,y:o.touches[0].clientY},A={...L})}),window.addEventListener("touchmove",ot,{passive:!1}),window.addEventListener("touchend",J),s.addEventListener("wheel",function(o){o.preventDefault(),o.deltaY<0?it():at()})}function st(e){!q||!$||(L.x=A.x+(e.clientX-S.x),L.y=A.y+(e.clientY-S.y),F())}function ot(e){!q||!$||e.touches.length!==1||(L.x=A.x+(e.touches[0].clientX-S.x),L.y=A.y+(e.touches[0].clientY-S.y),F(),e.preventDefault())}function J(){q=!1,$&&($.style.cursor="grab")}function it(){b=Math.min(b+.2,5),F()}function at(){b=Math.max(b-.2,.2),F()}function W(){b=1,L={x:0,y:0},F()}function F(){$&&($.style.transform=`scale(${b}) translate(${L.x/b}px, ${L.y/b}px)`)}function ve(){ee.classList.add("hidden"),document.body.classList.remove("media-overlay-active"),$=null,ue.innerHTML="",window.removeEventListener("mousemove",st),window.removeEventListener("mouseup",J),window.removeEventListener("touchmove",ot),window.removeEventListener("touchend",J)}xe&&(xe.onclick=ve);Be&&(Be.onclick=ve);Ie&&(Ie.onclick=it);Te&&(Te.onclick=at);Me&&(Me.onclick=W);document.addEventListener("keydown",function(e){e.key==="Escape"&&!ee.classList.contains("hidden")&&ve()});document.addEventListener("click",function(e){e.target.matches(".embed-image")&&Ne({src:e.target.src,type:"image"}),e.target.matches(".embed-video video")&&Ne({src:e.target.src,type:"video",poster:e.target.poster}),e.target.matches(".embed-video iframe")&&window.open(e.target.src,"_blank")});function Zt(e){return e.replace(/:([a-zA-Z0-9_+-]+):/g,(t,n)=>De[n]||t)}function Yt(e,t){e.querySelectorAll(".post-author-name, .post-username, .post-author-pic").forEach(n=>{n.addEventListener("click",function(s){s.stopPropagation(),H(t.uid)})}),e.querySelectorAll(".post-menu-btn").forEach(n=>{n.addEventListener("click",function(s){s.stopPropagation(),this.nextElementSibling.classList.toggle("show")})}),e.querySelectorAll(".post-menu-option.delete").forEach(n=>{n.addEventListener("click",function(s){s.stopPropagation();const o=this.closest(".post").getAttribute("data-post-id");_t(o)})}),e.querySelectorAll(".post-action").forEach(n=>{n.addEventListener("click",function(s){const o=this.closest(".post"),i=o.getAttribute("data-post-id"),a=this.getAttribute("data-action");if(a==="like")if(o.classList.contains("comment-post")){const c=o.getAttribute("data-comment-id"),l=o.getAttribute("data-parent-post-id");Fe(l,c)}else jt(i);else if(a==="comment"){const c=this.closest(".post").getAttribute("data-parent-post-id");c?le(c):qt(i,`@${t.username}`)}else a==="repost"&&Rt(i,t)})})}We(document.getElementById("post-input"));We(document.getElementById("comment-input"));setInterval(()=>{document.getElementById("comment-input").maxLength="512",document.getElementById("edit-bio").maxLength="160",document.getElementById("register-displayname").maxLength="20",document.getElementById("post-input").maxLength="512",document.getElementById("register-username").maxLength="20",document.getElementById("register-email").maxLength="100",document.getElementById("register-password").maxLength="100",document.getElementById("login-email").maxLength="100",document.getElementById("login-password").maxLength="100",document.getElementById("edit-display-name").maxLength="20",document.getElementById("edit-bio").maxLength="160"},10);
